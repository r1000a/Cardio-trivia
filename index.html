<!DOCTYPE html>
<html lang="es-UY">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬øQui√©n quiere ser cardi√≥logo? - Episodio 1</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, transparent 20%, rgba(59, 130, 246, 0.15) 20%, rgba(59, 130, 246, 0.15) 21%, transparent 21%, transparent 30%, rgba(59, 130, 246, 0.1) 30%, rgba(59, 130, 246, 0.1) 31%, transparent 31%);
            background-size: 60px 60px;
            animation: rotate 180s linear infinite;
            opacity: 0.4;
            z-index: -1;
        }
        
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(59, 130, 246, 0.1);
            position: relative;
            z-index: 1;
            max-height: 95vh;
            overflow-y: auto;
        }
        
        /* Logos institucionales */
        .institutional-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .logo {
            height: 60px;
            width: auto;
            opacity: 0.9;
            transition: all 0.3s ease;
            filter: brightness(1.1);
        }
        
        .logo:hover {
            opacity: 1;
            transform: scale(1.05);
        }
        
        .logo-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: #94a3b8;
            text-align: center;
            font-weight: 500;
        }
        
        h1 {
            font-size: 2.75rem;
            font-weight: 700;
            text-align: center;
            background: linear-gradient(135deg, #60a5fa, #3b82f6, #2563eb);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            letter-spacing: -0.025em;
        }
        
        h2 {
            font-size: 1.875rem;
            font-weight: 600;
            text-align: center;
            color: #60a5fa;
            margin-bottom: 24px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .subtitle {
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
            color: #94a3b8;
            font-size: 1.125rem;
            margin-bottom: 32px;
            letter-spacing: 0.05em;
            font-weight: 500;
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 32px;
            gap: 12px;
        }
        
        .nav-tab {
            background: rgba(30, 58, 138, 0.2);
            color: #e2e8f0;
            border: 2px solid rgba(59, 130, 246, 0.3);
            padding: 12px 24px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .nav-tab:hover:not(.active) {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Admin Panel */
        .admin-panel {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid rgba(220, 38, 38, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .admin-password {
            width: 300px;
            padding: 12px;
            margin: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(220, 38, 38, 0.3);
            border-radius: 8px;
            color: #e2e8f0;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .admin-data {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        /* Pantalla de inicio */
        #startScreen {
            text-align: center;
        }
        
        .form-group {
            margin: 24px 0;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.125rem;
            font-weight: 500;
            color: #60a5fa;
        }
        
        input, select {
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .privacy-note {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 24px 0;
            font-size: 0.875rem;
            color: #94a3b8;
            line-height: 1.6;
        }
        
        .btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 8px;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.025em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
        }
        
        /* Dashboard P√∫blico */
        .dashboard-section {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }
        
        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            border-color: rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            color: #60a5fa;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 8px;
        }
        
        .live-feed {
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .feed-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            animation: fadeIn 0.5s ease-out;
        }
        
        .feed-item:last-child {
            border-bottom: none;
        }
        
        .feed-player {
            font-weight: 600;
            color: #60a5fa;
        }
        
        .feed-score {
            color: #3b82f6;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
        }
        
        .feed-time {
            font-size: 0.75rem;
            color: #64748b;
        }
        
        /* Pantalla de juego */
        #gameScreen {
            display: none;
        }
        
        .game-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
            align-items: center;
            margin-bottom: 32px;
            padding: 24px;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .player-info, .game-stats, .comodines {
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
        }
        
        .lives {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }
        
        .heart {
            font-size: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
        }
        
        .heart.active {
            color: #60a5fa;
            transform: scale(1);
        }
        
        .heart.lost {
            color: #334155;
            transform: scale(0.8);
            filter: none;
        }
        
        .comodines {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .comodin {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .comodin:hover:not(:disabled) {
            transform: scale(1.05) translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        }
        
        .comodin:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Timer */
        .timer-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .timer {
            font-size: 2rem;
            font-weight: 700;
            color: #60a5fa;
            background: rgba(30, 41, 59, 0.8);
            padding: 12px 24px;
            border-radius: 50%;
            display: inline-block;
            min-width: 80px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .timer.warning {
            color: #f59e0b;
            border-color: #f59e0b;
            animation: pulse 0.5s infinite;
        }
        
        /* Pregunta y opciones */
        .question-container {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 32px;
            margin: 24px 0;
        }
        
        .question {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 32px;
            line-height: 1.6;
            color: #e2e8f0;
            text-align: center;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .option {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            text-align: left;
            line-height: 1.5;
            font-weight: 500;
        }
        
        .option:hover:not(.disabled) {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(59, 130, 246, 0.3);
        }
        
        .option.correct {
            background: linear-gradient(135deg, #059669, #047857);
            border-color: #10b981;
            color: white;
            animation: correctAnimation 0.6s ease-out;
        }
        
        .option.incorrect {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border-color: #ef4444;
            color: white;
            animation: shake 0.6s ease-out;
        }
        
        .option.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .option.eliminated {
            opacity: 0.3;
            background: rgba(51, 65, 85, 0.6);
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        @keyframes correctAnimation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Pantalla de nivel */
        #levelScreen {
            display: none;
            text-align: center;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 32px;
            margin: 24px 0;
        }
        
        .level-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 24px;
        }
        
        .level-description {
            font-size: 1.25rem;
            color: #94a3b8;
            margin-bottom: 32px;
            line-height: 1.6;
            font-style: italic;
        }
        
        /* Pantalla de resultados */
        #resultsScreen {
            display: none;
            text-align: center;
        }
        
        .final-score {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 24px 0;
        }
        
        .level-name {
            font-size: 1.5rem;
            color: #94a3b8;
            margin: 24px 0;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Rankings */
        .ranking-section {
            margin: 32px 0;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .ranking-title {
            font-size: 1.75rem;
            color: #60a5fa;
            margin-bottom: 24px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }
        
        .top-players {
            display: grid;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .player-rank {
            display: grid;
            grid-template-columns: 60px 2fr auto auto;
            gap: 16px;
            padding: 16px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .player-rank:hover {
            transform: translateY(-1px);
        }
        
        .player-rank.podium-1 {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.1));
            border: 2px solid #fbbf24;
        }
        
        .player-rank.podium-2 {
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.2), rgba(107, 114, 128, 0.1));
            border: 2px solid #9ca3af;
        }
        
        .player-rank.podium-3 {
            background: linear-gradient(135deg, rgba(194, 120, 3, 0.2), rgba(146, 64, 14, 0.1));
            border: 2px solid #c2750b;
        }
        
        .rank-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .rank-name {
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .rank-score {
            font-family: 'JetBrains Mono', monospace;
            color: #3b82f6;
            font-weight: 600;
        }
        
        .rank-title {
            color: #94a3b8;
            font-size: 0.75rem;
            font-style: italic;
            margin-top: 4px;
            line-height: 1.2;
        }
        
        .rank-level {
            font-family: 'JetBrains Mono', monospace;
            color: #60a5fa;
            font-size: 0.875rem;
        }
        
        .horoscope-section {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            padding: 24px;
            margin: 32px 0;
            text-align: left;
        }
        
        .horoscope-title {
            color: #60a5fa;
            text-align: center;
            margin-bottom: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }
        
        .horoscope-text {
            font-size: 1.125rem;
            line-height: 1.7;
            color: #e2e8f0;
            font-style: italic;
        }
        
        .loading {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.25rem;
            }
            
            .container {
                padding: 16px;
            }
            
            .institutional-header {
                flex-direction: column;
                gap: 20px;
            }
            
            .logo {
                height: 50px;
            }
            
            .game-header {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .options {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .player-rank {
                grid-template-columns: 40px 2fr auto;
                gap: 12px;
            }
            
            .rank-level {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header institucional -->
        <div class="institutional-header">
            <div class="logo-container">
                <img src="logo-ccu.png" alt="Centro Cardiovascular Universitario" class="logo" id="logo-ccu">
                <div class="logo-text">Centro Cardiovascular<br>Universitario</div>
            </div>
            <div class="logo-container">
                <img src="logo-uac.png" alt="Unidad Acad√©mica de Cardiolog√≠a" class="logo" id="logo-uac">
                <div class="logo-text">Unidad Acad√©mica<br>de Cardiolog√≠a</div>
            </div>
        </div>
        
        <!-- Navegaci√≥n -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</div>
            <div class="nav-tab" onclick="showTab('game')">üéÆ Jugar</div>
            <div class="nav-tab" onclick="showTab('admin')">üîê Admin</div>
        </div>
        
        <!-- Dashboard P√∫blico -->
        <div id="dashboard" class="tab-content active">
            <h1>üè• Dashboard P√∫blico</h1>
            <p class="subtitle">ESTAD√çSTICAS EN TIEMPO REAL</p>
            
            <!-- Estad√≠sticas Generales -->
            <div class="dashboard-section">
                <h2>üìà Estad√≠sticas Generales</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalJugadores">-</div>
                        <div class="stat-label">Total Jugadores</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="promedioScore">-</div>
                        <div class="stat-label">Puntaje Promedio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="nivelMaximo">-</div>
                        <div class="stat-label">Nivel M√°ximo Alcanzado</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="jugadoresHoy">-</div>
                        <div class="stat-label">Jugadores Hoy</div>
                    </div>
                </div>
            </div>
            
            <!-- Top 10 Global -->
            <div class="dashboard-section">
                <h2>üèÜ Top 10 Global</h2>
                <div class="top-players" id="topPlayers">
                    <div class="loading">Cargando rankings...</div>
                </div>
            </div>
            
            <!-- Feed en Vivo -->
            <div class="dashboard-section">
                <h2>üéÆ √öltimas Partidas</h2>
                <div class="live-feed" id="liveFeed">
                    <div class="loading">Cargando actividad reciente...</div>
                </div>
            </div>
        </div>
        
        <!-- Panel de Administraci√≥n -->
        <div id="admin" class="tab-content">
            <h1>üîê Panel de Administraci√≥n</h1>
            <p class="subtitle">ACCESO RESTRINGIDO</p>
            
            <div class="admin-panel">
                <h2>üîí Acceso Privado</h2>
                <p>Ingresa la contrase√±a para ver los datos de los participantes:</p>
                <input type="password" id="adminPassword" class="admin-password" placeholder="Contrase√±a de administrador">
                <br>
                <button class="btn" onclick="verifyAdmin()">Acceder</button>
                
                <div id="adminData" class="admin-data" style="display: none;">
                    <h3>üìã Registro Completo de Participantes</h3>
                    <button class="btn" onclick="exportAdminData()">üì• Descargar Excel</button>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Limpiar Datos</button>
                    
                    <div id="adminTable" style="margin-top: 20px;">
                        <!-- Tabla de admin se genera aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pantalla de Juego -->
        <div id="game" class="tab-content">
            <!-- Pantalla de inicio -->
            <div id="startScreen">
                <h1>¬øQui√©n quiere ser cardi√≥logo?</h1>
                <p class="subtitle">EPISODIO 1: INSUFICIENCIA CARD√çACA</p>
                
                <div class="form-group">
                    <label for="playerName">Nombre completo:</label>
                    <input type="text" id="playerName" placeholder="Dr. Juan P√©rez" required>
                </div>
                
                <div class="form-group">
                    <label for="playerId">C√©dula de identidad:</label>
                    <input type="text" id="playerId" placeholder="1.234.567-8" required>
                </div>
                
                <div class="form-group">
                    <label for="playerPseudonym">Pseud√≥nimo p√∫blico:</label>
                    <input type="text" id="playerPseudonym" placeholder="CardioMaster2025" required>
                </div>
                
                <div class="privacy-note">
                    üîí <strong>Privacidad:</strong> Tu nombre real y c√©dula son privados. En el ranking p√∫blico solo aparece tu pseud√≥nimo.
                </div>
                
                <div id="intentosMessage" style="display: none; color: #f59e0b; margin: 20px 0; font-weight: bold;"></div>
                
                <button class="btn" onclick="startGame()">COMENZAR AVENTURA</button>
            </div>
            
            <!-- Pantalla de juego -->
            <div id="gameScreen">
                <div class="game-header">
                    <div class="player-info">
                        <div>Jugador: <span id="displayName"></span></div>
                        <div>Pseud√≥nimo: <span id="displayPseudonym"></span></div>
                        <div class="lives">
                            Vidas: 
                            <span class="heart" id="heart1">üíô</span>
                            <span class="heart" id="heart2">üíô</span>
                            <span class="heart" id="heart3">üíô</span>
                        </div>
                    </div>
                    
                    <div class="game-stats">
                        <div>Nivel: <span id="currentLevelDisplay">1</span>/30</div>
                        <div>Puntaje: <span id="score">0</span></div>
                        <div class="timer-container">
                            <div class="timer" id="timer">30</div>
                        </div>
                    </div>
                    
                    <div class="comodines">
                        <button class="comodin" id="comodin5050" onclick="use5050()">üéØ 50/50</button>
                        <button class="comodin" id="comodinChange" onclick="changeQuestion()">üîÑ Cambiar</button>
                    </div>
                </div>
                
                <!-- Pantalla de nivel intermedia -->
                <div id="levelScreen">
                    <div class="level-title">NIVEL <span id="levelNumber"></span></div>
                    <div class="level-description" id="levelDescription"></div>
                    <button class="btn" onclick="startLevel()">COMENZAR NIVEL</button>
                </div>
                
                <div class="question-container" id="mainQuestionContainer" style="display: none;">
                    <div class="question" id="questionText"></div>
                    <div class="options" id="optionsContainer"></div>
                </div>
                
                <button class="btn" id="nextButton" style="display: none;" onclick="nextQuestion()">SIGUIENTE PREGUNTA</button>
            </div>
            
            <!-- Pantalla de resultados -->
            <div id="resultsScreen">
                <h1>¬°Juego Terminado!</h1>
                <div class="final-score">Puntaje Final: <span id="finalScore">0</span></div>
                <div class="level-name" id="levelName"></div>
                <div>Nivel m√°ximo alcanzado: <span id="maxLevel">1</span>/30</div>
                
                <!-- Descripci√≥n humor√≠stica del nivel -->
                <div class="horoscope-section">
                    <h3 class="horoscope-title">üîÆ Tu Hor√≥scopo Cardiol√≥gico</h3>
                    <div class="horoscope-text" id="levelHoroscope"></div>
                </div>
                
                <button class="btn" id="retryButton" onclick="retryGame()">üîÑ REINTENTAR</button>
                <button class="btn" onclick="newGame()">üë§ NUEVO JUGADOR</button>
                <button class="btn" onclick="showTab('dashboard')">üìä VER DASHBOARD</button>
            </div>
        </div>
    </div>
    
    <script>
        // Configuraci√≥n Firebase - TUS CREDENCIALES REALES
        const firebaseConfig = {
            apiKey: "AIzaSyAF1UK57tg4jK856RSU7Qcr1MT8QEeY4-o",
            authDomain: "cardiologia-game-uy.firebaseapp.com",
            databaseURL: "https://cardiologia-game-uy-default-rtdb.firebaseio.com",
            projectId: "cardiologia-game-uy",
            storageBucket: "cardiologia-game-uy.firebasestorage.app",
            messagingSenderId: "950754238661",
            appId: "1:950754238661:web:3df1bc9c9089f3308410ac",
            measurementId: "G-R6SPME7MHK"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Variables globales
        let currentPlayer = { name: '', id: '', pseudonym: '' };
        let currentLevel = 1;
        let score = 0;
        let lives = 3;
        let maxLevelReached = 1;
        let currentQuestion = null;
        let answeredQuestions = new Set();
        let timeLeft = 30;
        let timerInterval = null;
        let comodines = { fifty: true, change: true };
        let shuffledOptions = [];
        let eliminated5050 = false;
        let playerAttempts = 0;
        let isAdminAuthenticated = false;
        const ADMIN_PASSWORD = "cardio2025admin";
        
        // Banco de preguntas cl√≠nicas avanzadas para cardi√≥logos (90 preguntas)
        const questionBank = [
            // Nivel 1-3: Diagn√≥stico y clasificaci√≥n avanzada
            {"level": 1, "question": "Seg√∫n las gu√≠as ESC 2021, ¬øcu√°l es el punto de corte de NT-proBNP para descartar IC aguda en pacientes >75 a√±os?", "options": [{"text": "< 450 pg/ml", "correct": false}, {"text": "< 900 pg/ml", "correct": true}, {"text": "< 1800 pg/ml", "correct": false}, {"text": "< 300 pg/ml", "correct": false}]},
            {"level": 1, "question": "¬øCu√°l es el criterio ecocardiogr√°fico principal para definir ICFEp seg√∫n las gu√≠as actuales?", "options": [{"text": "FEVI ‚â•50% + evidencia de disfunci√≥n diast√≥lica", "correct": true}, {"text": "FEVI ‚â•45% + dilataci√≥n auricular", "correct": false}, {"text": "FEVI ‚â•40% + hipertrofia ventricular", "correct": false}, {"text": "FEVI ‚â•55% + insuficiencia mitral", "correct": false}]},
            {"level": 1, "question": "En la clasificaci√≥n fenot√≠pica actual de IC, ¬øqu√© define a la ICFEli (ligeramente reducida)?", "options": [{"text": "FEVI 35-40%", "correct": false}, {"text": "FEVI 41-49%", "correct": true}, {"text": "FEVI 45-55%", "correct": false}, {"text": "FEVI 30-45%", "correct": false}]},

            {"level": 2, "question": "Seg√∫n PARADIGM-HF, ¬øcu√°l fue la reducci√≥n de mortalidad cardiovascular con sacubitrilo/valsart√°n vs enalapril?", "options": [{"text": "15%", "correct": false}, {"text": "20%", "correct": true}, {"text": "25%", "correct": false}, {"text": "30%", "correct": false}]},
            {"level": 2, "question": "¬øCu√°l es la dosis objetivo de carvedilol en IC seg√∫n las gu√≠as ESC?", "options": [{"text": "25 mg c/12h", "correct": true}, {"text": "12.5 mg c/12h", "correct": false}, {"text": "50 mg c/12h", "correct": false}, {"text": "6.25 mg c/12h", "correct": false}]},
            {"level": 2, "question": "En el estudio EMPEROR-Reduced, ¬øqu√© porcentaje de reducci√≥n del end-point primario mostr√≥ empagliflozina?", "options": [{"text": "20%", "correct": false}, {"text": "25%", "correct": true}, {"text": "30%", "correct": false}, {"text": "15%", "correct": false}]},

            {"level": 3, "question": "¬øCu√°l es el criterio de QRS para indicar TRC seg√∫n las gu√≠as ESC 2021?", "options": [{"text": "QRS ‚â•120 ms", "correct": false}, {"text": "QRS ‚â•130 ms", "correct": false}, {"text": "QRS ‚â•150 ms con LBBB", "correct": true}, {"text": "QRS ‚â•140 ms", "correct": false}]},
            {"level": 3, "question": "En DAPA-HF, ¬øcu√°l fue el NNT (number needed to treat) para prevenir un evento primario con dapagliflozina?", "options": [{"text": "15", "correct": false}, {"text": "21", "correct": true}, {"text": "28", "correct": false}, {"text": "35", "correct": false}]},
            {"level": 3, "question": "¬øCu√°l es la indicaci√≥n principal para ivabradina en IC seg√∫n las gu√≠as actuales?", "options": [{"text": "FC >70 lpm en ritmo sinusal, FEVI ‚â§35%, en terapia √≥ptima con BB", "correct": true}, {"text": "Cualquier FC >80 lpm", "correct": false}, {"text": "Solo en intolerancia a betabloqueantes", "correct": false}, {"text": "FC >65 lpm con cualquier FEVI", "correct": false}]},

            // Nivel 4-6: Fisiopatolog√≠a y mecanismos avanzados
            {"level": 4, "question": "¬øCu√°l es el mecanismo principal por el cual los iSGLT2 mejoran outcomes en IC?", "options": [{"text": "Reducci√≥n de precarga por diuresis osm√≥tica", "correct": false}, {"text": "Mejora del metabolismo energ√©tico mioc√°rdico", "correct": true}, {"text": "Vasodilataci√≥n coronaria directa", "correct": false}, {"text": "Reducci√≥n de la resistencia vascular sist√©mica", "correct": false}]},
            {"level": 4, "question": "En la IC, ¬øqu√© valor de PCWP (presi√≥n capilar pulmonar) define congesti√≥n hemodin√°mica?", "options": [{"text": ">12 mmHg", "correct": false}, {"text": ">15 mmHg", "correct": false}, {"text": ">18 mmHg", "correct": true}, {"text": ">25 mmHg", "correct": false}]},
            {"level": 4, "question": "¬øCu√°l es el valor normal del √≠ndice card√≠aco en reposo?", "options": [{"text": "1.8-2.2 L/min/m¬≤", "correct": false}, {"text": "2.5-4.0 L/min/m¬≤", "correct": true}, {"text": "4.0-5.5 L/min/m¬≤", "correct": false}, {"text": "1.5-2.0 L/min/m¬≤", "correct": false}]},

            {"level": 5, "question": "Seg√∫n el perfil hemodin√°mico de Forrester, ¬øqu√© caracteriza al perfil C (h√∫medo-fr√≠o)?", "options": [{"text": "PCWP >18 mmHg, IC <2.2 L/min/m¬≤", "correct": true}, {"text": "PCWP <18 mmHg, IC >2.2 L/min/m¬≤", "correct": false}, {"text": "PCWP >18 mmHg, IC >2.2 L/min/m¬≤", "correct": false}, {"text": "PCWP <15 mmHg, IC <2.0 L/min/m¬≤", "correct": false}]},
            {"level": 5, "question": "¬øCu√°l es el umbral de troponina para considerar da√±o mioc√°rdico en IC aguda?", "options": [{"text": "Cualquier elevaci√≥n sobre el percentil 99", "correct": true}, {"text": ">0.1 ng/ml", "correct": false}, {"text": ">1.0 ng/ml", "correct": false}, {"text": ">5.0 ng/ml", "correct": false}]},
            {"level": 5, "question": "En el cateterismo derecho, ¬øqu√© define al 'square root sign'?", "options": [{"text": "Igualaci√≥n de presiones diast√≥licas en pericarditis constrictiva", "correct": true}, {"text": "Onda V prominente en insuficiencia tricusp√≠dea", "correct": false}, {"text": "Gradiente diast√≥lico en estenosis mitral", "correct": false}, {"text": "Presi√≥n sist√≥lica pulmonar >60 mmHg", "correct": false}]},

            // Nivel 6-10: Tratamiento avanzado y complicaciones
            {"level": 6, "question": "¬øCu√°l es la dosis de espironolactona que demostr√≥ beneficio en mortalidad en RALES?", "options": [{"text": "12.5-25 mg/d√≠a", "correct": false}, {"text": "25-50 mg/d√≠a", "correct": true}, {"text": "50-100 mg/d√≠a", "correct": false}, {"text": "100-200 mg/d√≠a", "correct": false}]},
            {"level": 6, "question": "En SHIFT, ¬øcu√°l fue la reducci√≥n del endpoint primario con ivabradina?", "options": [{"text": "15%", "correct": false}, {"text": "18%", "correct": true}, {"text": "22%", "correct": false}, {"text": "25%", "correct": false}]},
            {"level": 6, "question": "¬øCu√°l es la contraindicaci√≥n absoluta para TRC?", "options": [{"text": "QRS <120 ms", "correct": false}, {"text": "Expectativa de vida <1 a√±o", "correct": true}, {"text": "FEVI >35%", "correct": false}, {"text": "Fibrilaci√≥n auricular", "correct": false}]},

            {"level": 7, "question": "En IC aguda con EAP cardiog√©nico, ¬øcu√°l es la PO2 objetivo inicial?", "options": [{"text": ">60 mmHg", "correct": false}, {"text": ">90 mmHg", "correct": true}, {"text": ">100 mmHg", "correct": false}, {"text": ">70 mmHg", "correct": false}]},
            {"level": 7, "question": "¬øCu√°l es el efecto principal de la levosimendan?", "options": [{"text": "Inhibici√≥n de fosfodiesterasa III", "correct": false}, {"text": "Sensibilizaci√≥n al calcio + apertura de canales KATP", "correct": true}, {"text": "Agonismo beta-1 selectivo", "correct": false}, {"text": "Inhibici√≥n de recaptaci√≥n de noradrenalina", "correct": false}]},
            {"level": 7, "question": "En shock cardiog√©nico, ¬øcu√°l es el valor de IABP m√°s apropiado?", "options": [{"text": "1:1", "correct": true}, {"text": "1:2", "correct": false}, {"text": "1:3", "correct": false}, {"text": "2:1", "correct": false}]},

            {"level": 8, "question": "¬øCu√°l es el criterio para 'worsening renal function' en IC aguda?", "options": [{"text": "Aumento de creatinina >0.3 mg/dl", "correct": true}, {"text": "Reducci√≥n de FG >25%", "correct": false}, {"text": "Aumento de urea >20 mg/dl", "correct": false}, {"text": "Oliguria <0.5 ml/kg/h", "correct": false}]},
            {"level": 8, "question": "En el score MAGGIC, ¬øcu√°les son los predictores m√°s potentes de mortalidad?", "options": [{"text": "Edad, creatinina, FEVI, clase NYHA", "correct": true}, {"text": "Solo FEVI y BNP", "correct": false}, {"text": "Presi√≥n sist√≥lica y FC", "correct": false}, {"text": "Diabetes y enfermedad coronaria", "correct": false}]},
            {"level": 8, "question": "¬øCu√°l es la definici√≥n de IC refractaria seg√∫n la ISHLT?", "options": [{"text": "NYHA IV persistente pese a terapia √≥ptima", "correct": true}, {"text": "Hospitalizaciones recurrentes", "correct": false}, {"text": "FEVI <20%", "correct": false}, {"text": "Dependencia de inotr√≥picos", "correct": false}]},

            // Nivel 9-15: Casos complejos y scoring
            {"level": 9, "question": "En el score INTERMACS, ¬øqu√© define el perfil 1?", "options": [{"text": "Shock cardiog√©nico cr√≠tico con hipoperfusi√≥n", "correct": true}, {"text": "IC sintom√°tica en reposo", "correct": false}, {"text": "Limitaci√≥n severa al ejercicio", "correct": false}, {"text": "IC avanzada ambulatoria", "correct": false}]},
            {"level": 9, "question": "¬øCu√°l es el Gold Standard para medir el consumo de ox√≠geno pico?", "options": [{"text": "Ergometr√≠a convencional", "correct": false}, {"text": "Test de 6 minutos", "correct": false}, {"text": "Ergoespirometr√≠a", "correct": true}, {"text": "Ecocardiograma de stress", "correct": false}]},
            {"level": 9, "question": "¬øQu√© valor de VO2 pico define IC severa en <50 a√±os?", "options": [{"text": "<14 ml/kg/min", "correct": true}, {"text": "<18 ml/kg/min", "correct": false}, {"text": "<20 ml/kg/min", "correct": false}, {"text": "<12 ml/kg/min", "correct": false}]},

            {"level": 10, "question": "En la evaluaci√≥n para trasplante card√≠aco, ¬øcu√°l es el VE/VCO2 slope de mal pron√≥stico?", "options": [{"text": ">35", "correct": true}, {"text": ">45", "correct": false}, {"text": ">25", "correct": false}, {"text": ">30", "correct": false}]},
            {"level": 10, "question": "¬øCu√°l es la contraindicaci√≥n relativa para trasplante por resistencia vascular pulmonar?", "options": [{"text": "RVP >3 unidades Wood irreversible", "correct": true}, {"text": "RVP >2 unidades Wood", "correct": false}, {"text": "Gradiente transpulmonar >12 mmHg", "correct": false}, {"text": "Presi√≥n sist√≥lica pulmonar >50 mmHg", "correct": false}]},
            {"level": 10, "question": "En IC con FA, ¬øcu√°l es el score CHA2DS2-VASc para anticoagulaci√≥n obligatoria?", "options": [{"text": "‚â•1 en hombres, ‚â•2 en mujeres", "correct": true}, {"text": "‚â•2 en todos", "correct": false}, {"text": "‚â•3 en todos", "correct": false}, {"text": "‚â•1 en todos", "correct": false}]},

            // Nivel 11-20: Procedimientos y t√©cnicas avanzadas
            {"level": 11, "question": "En TAVI, ¬øcu√°l es el gradiente medio a√≥rtico considerado severo?", "options": [{"text": ">20 mmHg", "correct": false}, {"text": ">40 mmHg", "correct": true}, {"text": ">30 mmHg", "correct": false}, {"text": ">50 mmHg", "correct": false}]},
            {"level": 11, "question": "¬øCu√°l es la indicaci√≥n clase I para MitraClip seg√∫n ESC?", "options": [{"text": "IM severa primaria inoperable con s√≠ntomas", "correct": true}, {"text": "IM moderada sintom√°tica", "correct": false}, {"text": "IM secundaria en cualquier grado", "correct": false}, {"text": "IM severa asintom√°tica", "correct": false}]},
            {"level": 11, "question": "En el implante de DAV, ¬øcu√°l es la complicaci√≥n m√°s frecuente?", "options": [{"text": "Sangrado", "correct": true}, {"text": "Infecci√≥n", "correct": false}, {"text": "ACV", "correct": false}, {"text": "Falla del dispositivo", "correct": false}]},

            {"level": 12, "question": "¬øCu√°l es el tiempo √≥ptimo de isquemia fr√≠a en trasplante card√≠aco?", "options": [{"text": "<4 horas", "correct": true}, {"text": "<6 horas", "correct": false}, {"text": "<8 horas", "correct": false}, {"text": "<2 horas", "correct": false}]},
            {"level": 12, "question": "En rechazo agudo post-trasplante, ¬øqu√© grado ISHLT requiere tratamiento inmediato?", "options": [{"text": "‚â•2R", "correct": true}, {"text": "‚â•1R", "correct": false}, {"text": "‚â•3R", "correct": false}, {"text": "Solo 3R", "correct": false}]},
            {"level": 12, "question": "¬øCu√°l es la dosis de mantenimiento t√≠pica de tacrolimus post-trasplante?", "options": [{"text": "Nivel 8-12 ng/ml", "correct": true}, {"text": "Nivel 15-20 ng/ml", "correct": false}, {"text": "Nivel 5-8 ng/ml", "correct": false}, {"text": "Nivel 20-25 ng/ml", "correct": false}]},

            // Nivel 13-25: Investigaci√≥n y gu√≠as recientes
            {"level": 13, "question": "En VICTORIA, ¬øcu√°l fue la reducci√≥n del endpoint primario con vericiguat?", "options": [{"text": "10%", "correct": true}, {"text": "15%", "correct": false}, {"text": "20%", "correct": false}, {"text": "5%", "correct": false}]},
            {"level": 13, "question": "¬øCu√°l es el mecanismo de acci√≥n del vericiguat?", "options": [{"text": "Estimulador de guanilato ciclasa soluble", "correct": true}, {"text": "Inhibidor de fosfodiesterasa V", "correct": false}, {"text": "Activador de NO sintasa", "correct": false}, {"text": "Bloqueador de endotelina", "correct": false}]},
            {"level": 13, "question": "En SOLOIST-WHF, ¬øcu√°ndo se inici√≥ sotagliflozina post-hospitalizaci√≥n?", "options": [{"text": "Antes del alta hospitalaria", "correct": true}, {"text": "A los 30 d√≠as", "correct": false}, {"text": "A los 7 d√≠as", "correct": false}, {"text": "A las 48 horas", "correct": false}]},

            {"level": 14, "question": "En GALACTIC-HF, ¬øcu√°l fue el resultado del omecamtiv mecarbil?", "options": [{"text": "Reducci√≥n modest del endpoint primario", "correct": true}, {"text": "Sin beneficio significativo", "correct": false}, {"text": "Aumento de mortalidad", "correct": false}, {"text": "Beneficio solo en subgrupos", "correct": false}]},
            {"level": 14, "question": "¬øCu√°l es el mecanismo de omecamtiv mecarbil?", "options": [{"text": "Activador selectivo de miosina card√≠aca", "correct": true}, {"text": "Inhibidor de troponina", "correct": false}, {"text": "Modulador de calcio", "correct": false}, {"text": "Estimulador de actina", "correct": false}]},
            {"level": 14, "question": "En STRONG-HF, ¬øcu√°l fue la estrategia de up-titration?", "options": [{"text": "Intensificaci√≥n r√°pida con seguimiento estrecho", "correct": true}, {"text": "Titulaci√≥n est√°ndar lenta", "correct": false}, {"text": "Solo ajuste de diur√©ticos", "correct": false}, {"text": "Titulaci√≥n guiada por BNP", "correct": false}]},

            // Nivel 15-25: Casos extremos y subespecialidades
            {"level": 15, "question": "En IC con amiloidosis, ¬øcu√°l es el signo patognom√≥nico en ECG?", "options": [{"text": "Bajo voltaje con hipertrofia en eco", "correct": true}, {"text": "QRS fragmentado", "correct": false}, {"text": "Ondas Q septales", "correct": false}, {"text": "Prolongaci√≥n QT", "correct": false}]},
            {"level": 15, "question": "¬øCu√°l es el tratamiento espec√≠fico para amiloidosis TTR hereditaria?", "options": [{"text": "Tafamidis", "correct": true}, {"text": "Doxiciclina", "correct": false}, {"text": "Diflunisal", "correct": false}, {"text": "Patisiran", "correct": false}]},

            {"level": 16, "question": "En miocardiopat√≠a hipertr√≥fica obstructiva, ¬øcu√°l es el gradiente para considerar intervenci√≥n?", "options": [{"text": "‚â•50 mmHg en reposo o ‚â•30 mmHg provocado", "correct": true}, {"text": "‚â•30 mmHg en reposo", "correct": false}, {"text": "‚â•70 mmHg provocado", "correct": false}, {"text": "‚â•40 mmHg en cualquier condici√≥n", "correct": false}]},
            {"level": 16, "question": "En HCMP, ¬øcu√°l es la indicaci√≥n para mavacamten?", "options": [{"text": "NYHA II-III con obstrucci√≥n sintom√°tica", "correct": true}, {"text": "Cualquier HCMP", "correct": false}, {"text": "Solo NYHA IV", "correct": false}, {"text": "HCMP asintom√°tica", "correct": false}]},

            {"level": 17, "question": "En IC por quimioterapia, ¬øcu√°l es el umbral de FEVI para suspender trastuzumab?", "options": [{"text": "Ca√≠da >10% y FEVI <53%", "correct": true}, {"text": "FEVI <50%", "correct": false}, {"text": "Ca√≠da >15%", "correct": false}, {"text": "FEVI <45%", "correct": false}]},
            {"level": 17, "question": "¬øCu√°l es el tratamiento preventivo m√°s efectivo para cardiotoxicidad por antraciclinas?", "options": [{"text": "Dexrazoxano", "correct": true}, {"text": "IECA profil√°cticos", "correct": false}, {"text": "Betabloqueantes", "correct": false}, {"text": "Estatinas", "correct": false}]},

            {"level": 18, "question": "En IC pedi√°trica, ¬øcu√°l es la causa m√°s frecuente en lactantes?", "options": [{"text": "Malformaciones cong√©nitas", "correct": true}, {"text": "Miocarditis", "correct": false}, {"text": "Miocardiopat√≠a dilatada", "correct": false}, {"text": "Enfermedad de Kawasaki", "correct": false}]},

            {"level": 19, "question": "En IC y embarazo, ¬øcu√°l es el f√°rmaco de elecci√≥n para hipertensi√≥n?", "options": [{"text": "Metildopa", "correct": true}, {"text": "IECA", "correct": false}, {"text": "Amlodipino", "correct": false}, {"text": "Hidroclorotiazida", "correct": false}]},

            {"level": 20, "question": "En miocardiopat√≠a periparto, ¬øcu√°l es el factor de riesgo m√°s importante?", "options": [{"text": "Edad >35 a√±os y multiparidad", "correct": true}, {"text": "Solo preeclampsia", "correct": false}, {"text": "Diabetes gestacional", "correct": false}, {"text": "Anemia", "correct": false}]},

            // Nivel 21-30: Fronteras del conocimiento
            {"level": 21, "question": "En el uso de c√©lulas madre para IC, ¬øcu√°l mostr√≥ mayor promesa en estudios?", "options": [{"text": "C√©lulas madre mesenquimales", "correct": true}, {"text": "C√©lulas madre embrionarias", "correct": false}, {"text": "C√©lulas iPS", "correct": false}, {"text": "C√©lulas sat√©lite", "correct": false}]},

            {"level": 22, "question": "¬øCu√°l es el biomarcador emergente m√°s prometedor para IC?", "options": [{"text": "Galectina-3", "correct": true}, {"text": "MicroRNA-21", "correct": false}, {"text": "Troponina ultrasensible", "correct": false}, {"text": "CRP ultrasensible", "correct": false}]},

            {"level": 23, "question": "En terapia g√©nica para IC, ¬øcu√°l es el target m√°s estudiado?", "options": [{"text": "SERCA2a", "correct": true}, {"text": "Miosina", "correct": false}, {"text": "Troponina C", "correct": false}, {"text": "Fosfolamban", "correct": false}]},

            {"level": 24, "question": "¬øCu√°l es la t√©cnica m√°s promisoria para regeneraci√≥n mioc√°rdica?", "options": [{"text": "Cardiomiocitos derivados de iPS", "correct": true}, {"text": "Parches de col√°geno", "correct": false}, {"text": "Factores de crecimiento", "correct": false}, {"text": "Nanomateriales", "correct": false}]},

            {"level": 25, "question": "En AI para IC, ¬øcu√°l es la aplicaci√≥n m√°s desarrollada actualmente?", "options": [{"text": "Predicci√≥n de descompensaci√≥n", "correct": true}, {"text": "Diagn√≥stico autom√°tico", "correct": false}, {"text": "Selecci√≥n de f√°rmacos", "correct": false}, {"text": "An√°lisis de imagen", "correct": false}]},

            {"level": 26, "question": "¬øCu√°l es el mecanismo propuesto para la terapia con ultrasonido en IC?", "options": [{"text": "Estimulaci√≥n de angiog√©nesis", "correct": true}, {"text": "Destrucci√≥n de fibrosis", "correct": false}, {"text": "Activaci√≥n neuronal", "correct": false}, {"text": "Modulaci√≥n i√≥nica", "correct": false}]},

            {"level": 27, "question": "En optogen√©tica card√≠aca, ¬øcu√°l es el canal m√°s estudiado?", "options": [{"text": "Channelrhodopsin-2", "correct": true}, {"text": "Halorhodopsin", "correct": false}, {"text": "Archaerhodopsin", "correct": false}, {"text": "OptoXR", "correct": false}]},

            {"level": 28, "question": "¬øCu√°l es la limitaci√≥n principal de los corazones artificiales totales actuales?", "options": [{"text": "Tromboembolismo", "correct": true}, {"text": "Duraci√≥n de bater√≠a", "correct": false}, {"text": "Tama√±o del dispositivo", "correct": false}, {"text": "Rechazo inmune", "correct": false}]},

            {"level": 29, "question": "En xenotrasplante card√≠aco, ¬øcu√°l es la modificaci√≥n gen√©tica m√°s cr√≠tica en cerdos?", "options": [{"text": "Knockout de alfa-galactosil transferasa", "correct": true}, {"text": "Knockout de MHC", "correct": false}, {"text": "Overexpresi√≥n de CD55", "correct": false}, {"text": "Knockout de perforina", "correct": false}]},

            {"level": 30, "question": "¬øCu√°l representa el mayor desaf√≠o actual en medicina de precisi√≥n para IC?", "options": [{"text": "Integraci√≥n de gen√≥mica, prote√≥mica y fen√≥mica cl√≠nica", "correct": true}, {"text": "Costos de secuenciaci√≥n", "correct": false}, {"text": "Falta de biomarcadores", "correct": false}, {"text": "Resistencia de pacientes", "correct": false}]}
        ];
        
        // El banco de preguntas ya est√° completo con 90 preguntas reales
        
        // T√≠tulos por nivel (30 niveles completos)
        const levelTitles = {
            1: "El que cura todo con agua con sal",
            2: "El que dice 'para el coraz√≥n lo mejor es el ajo'",
            3: "El botija que confunde un estetoscopio con un cargador",
            4: "El que cree que la presi√≥n se mide con el dedo en la mu√±eca",
            5: "El interno que ausculta la espalda buscando el ritmo sinusal",
            6: "El que receta ibuprofeno para el dolor precordial 'por las dudas'",
            7: "El que cree que el ecocardio se hace con gel y buena onda",
            8: "Aquel que convierte un dolor de pecho en un diagn√≥stico de 15 l√≠neas",
            9: "El que interpreta la radiograf√≠a como si fuera una constelaci√≥n",
            10: "El que escucha un soplo y pide en secreto que no le pregunten de qu√© es",
            11: "El que prescribe seg√∫n lo que ley√≥ en un grupo de WhatsApp",
            12: "El que dice 'probemos con carvedilol a ver qu√© pasa'",
            13: "El que escucha un R3 y lo anota aunque no est√© seguro si no eran gases",
            14: "El que ya no dice 'tiene algo de falla' habla de IC con elementos congestivos",
            15: "El que pide BNP con cara seria aunque no sepa bien c√≥mo interpretarlo",
            16: "El que empieza a citar art√≠culos y ya no solo frases de la cl√≠nica m√©dica",
            17: "El que entiende que no todo lo que se hincha es por 'retenci√≥n'",
            18: "El que ya no ve todo como blanco y negro sino como 4 cuadrantes de Forrester",
            19: "El que sabe que los gliflozins no son una banda de rock noruega",
            20: "El que dej√≥ de hablar de la FEVI, y mete strain y remodelado",
            21: "El que se emociona con un TAPSE >20 como si fuera una buena noticia familiar",
            22: "El que empieza a explicar la IC con analog√≠as elegantes",
            23: "El que discute la clasificaci√≥n universal de infarto como si hubiera estado en la mesa donde la armaron",
            24: "El que ajusta dosis de beta bloqueantes como quien afina una guitarra",
            25: "El que lee el ECG como si fuera partitura y encuentra la m√∫sica oculta",
            26: "El que distingue entre empeoramiento cl√≠nico y progresi√≥n insidiosa",
            27: "El que recomienda rehabilitaci√≥n cardiaca y se emociona al decir 'multidisciplinario'",
            28: "El que se indigna si no hay seguimiento post-alta",
            29: "El que gu√≠a al Heart Team con calma y convicci√≥n, como pastor cl√≠nico",
            30: "Or√°culo cardiol√≥gico Manuel Quintela, de punta y al medio"
        };
        
        // Descripciones humor√≠sticas (30 hor√≥scopos √∫nicos)
        const levelDescriptions = {
            1: "Felicitaciones, est√°s en el nivel b√°sico de la medicina casera. Tu principal herramienta terap√©utica es el agua con sal, que seg√∫n vos cura desde un resfr√≠o hasta una arritmia ventricular. En el fondo, ten√©s fe ciega en los remedios de la abuela.",
            2: "Has avanzado al nivel de curandero barrial. Tu arsenal se expandi√≥: ajo para la presi√≥n, manzanilla para los nervios y cebolla para todo lo dem√°s. Todav√≠a cre√©s que el lim√≥n puede destapar arterias.",
            3: "Sos ese interno tierno que todos quieren proteger. Confund√≠s cables con instrumental m√©dico y ten√©s esa inocencia que hace que los pacientes te sonr√≠an con ternura. Al menos ya no intent√°s escuchar el coraz√≥n por la espalda.",
            4: "Nivel estudiante avanzado: ya sab√©s que el pulso no se toma con el dedo gordo, pero segu√≠s buscando el punto exacto en la mu√±eca como si fuera un tesoro escondido. Los pacientes te tienen paciencia.",
            5: "Sos el que ausculta con cara seria pero en realidad est√° rezando para que no le pregunten qu√© escuchaste. Al menos ya diferenci√°s entre un pulm√≥n y un coraz√≥n en la radiograf√≠a.",
            6: "Nivel 'm√©dico precavido': para cualquier dolor en el pecho recet√°s ibuprofeno 'por las dudas' y mand√°s al paciente a caminar. Tu filosof√≠a es 'si se mejora solo, mejor'.",
            7: "Ya entendiste que el ecocardiograma no es solo gel y buena onda, pero segu√≠s viendo las im√°genes como si fueran nubes en el cielo. Al menos pregunt√°s cosas que suenan t√©cnicas.",
            8: "Has desarrollado el talento especial de convertir un simple dolor de pecho en un diagn√≥stico diferencial de 15 patolog√≠as. Tu especialidad es encontrar zebras donde hay caballos.",
            9: "Interpret√°s las radiograf√≠as como constelaciones c√≥smicas. Ves patrones donde no los hay, pero al menos ya no confund√≠s una costilla con el coraz√≥n. Progreso lento pero seguro.",
            10: "Escuch√°s soplos por todos lados, aunque no est√©s muy seguro de qu√© tipo son. Tu estrategia es anotar 'soplo sist√≥lico grado II/VI' y que alguien m√°s se haga cargo.",
            11: "Tu conocimiento m√©dico proviene principalmente de grupos de WhatsApp de m√©dicos. Cit√°s papers que nunca le√≠ste completos y us√°s t√©rminos en ingl√©s para sonar m√°s profesional.",
            12: "Entraste en la era del carvedilol experimental. Tu frase favorita es 'probemos con carvedilol a ver qu√© pasa'. Al menos ya sab√©s que es un betabloqueante.",
            13: "Desarrollaste el o√≠do m√°gico para escuchar R3, aunque la mitad de las veces son gases intestinales. Pero lo anot√°s en la historia igual, por si acaso ten√≠as raz√≥n.",
            14: "Evolucionaste del 'tiene algo de falla' al sofisticado 'IC con elementos congestivos'. Tu vocabulario se est√° volviendo m√°s elegante, aunque segu√≠s sin estar muy seguro.",
            15: "Ped√≠s BNP con cara de experto, aunque despu√©s google√°s discretamente c√≥mo interpretarlo. Al menos ya sab√©s que tiene que ver con el coraz√≥n y no con el ri√±√≥n.",
            16: "Comenzaste a citar estudios reales: 'seg√∫n PARADIGM-HF...' aunque solo le√≠ste el abstract. Pero son√°s convincente y eso es lo que importa en esta etapa.",
            17: "Ya entendiste que no todo lo que se hincha es 'retenci√≥n'. Empezaste a usar t√©rminos como 'sobrecarga de volumen' y 'redistribuci√≥n'. Tu evoluci√≥n sem√°ntica es notable.",
            18: "Descubriste los cuadrantes de Forrester y ahora clasific√°s todo en h√∫medo-seco, fr√≠o-caliente. Es como el juego de la batalla naval pero con hemodinamia.",
            19: "Aprendiste que los gliflozinas no son una banda noruega de metal, sino que son medicamentos revolucionarios. Empezaste a recetar con m√°s fundamento cient√≠fico.",
            20: "Dejaste de hablar solo de FEVI. Ahora met√©s strain, remodelado y funci√≥n diast√≥lica. Tu jerga cardiol√≥gica se est√° volviendo respetable y casi comprensible.",
            21: "Te emocion√°s genuinamente cuando ves un TAPSE mayor a 20 mm, como si fuera una buena noticia familiar. Ya entend√©s que el ventr√≠culo derecho tambi√©n existe e importa.",
            22: "Desarrollaste el arte de explicar la IC con analog√≠as elegantes: compar√°s el coraz√≥n con una bomba de agua, los vasos con mangueras. Tus pacientes te entienden y agradecen.",
            23: "Discut√≠s la clasificaci√≥n universal de infarto como si hubieras estado en la mesa donde la escribieron. Cit√°s a Thygesen con la familiaridad de quien lo conoce personalmente.",
            24: "Ajust√°s dosis de betabloqueantes como un m√∫sico que afina su guitarra: con precisi√≥n, paciencia y sabiendo que cada peque√±o cambio puede hacer una gran diferencia.",
            25: "Le√©s el ECG como si fuera una partitura musical y encontr√°s la melod√≠a oculta en cada complejo QRS. Los ritmos card√≠acos tienen m√∫sica para vos.",
            26: "Distingu√≠s entre empeoramiento cl√≠nico franco y progresi√≥n insidiosa silenciosa. Tu ojo cl√≠nico se afin√≥ y pod√©s detectar matices sutiles que antes te pasaban inadvertidos.",
            27: "Recomend√°s rehabilitaci√≥n card√≠aca y te emocion√°s al pronunciar 'abordaje multidisciplinario'. Entendiste que curar no es solo recetar pastillas.",
            28: "Te indign√°s genuinamente cuando no hay seguimiento post-alta adecuado. Sab√©s que el alta hospitalaria es solo el comienzo del verdadero tratamiento.",
            29: "Gui√°s al Heart Team con la calma y convicci√≥n de un pastor experimentado. Tu juicio cl√≠nico se volvi√≥ una br√∫jula confiable para decisiones complejas.",
            30: "Llegaste al olimpo cardiol√≥gico uruguayo. Sos el or√°culo del Hospital de Cl√≠nicas, de punta y al medio. Los residentes te consultan, los adjuntos te respetan, y los pacientes te bendicen."
        };
        
        // Inicializaci√≥n
        window.addEventListener('load', function() {
            loadDashboard();
            setupFirebaseListeners();
            updateLivesDisplay();
            handleMissingLogos();
            console.log('App inicializada con Firebase - Banco de preguntas:', questionBank.length);
        });
        
        // Manejar logos faltantes
        function handleMissingLogos() {
            const logos = ['logo-ccu', 'logo-uac'];
            logos.forEach(logoId => {
                const img = document.getElementById(logoId);
                img.onerror = function() {
                    this.style.display = 'none';
                    this.nextElementSibling.style.display = 'none';
                };
            });
        }
        
        // Funciones de navegaci√≥n
        function showTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ocultar todos los nav-tabs activos
            document.querySelectorAll('.nav-tab').forEach(navTab => {
                navTab.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(tabName).classList.add('active');
            
            // Activar nav-tab correspondiente
            event.target.classList.add('active');
            
            // Recargar dashboard si es necesario
            if (tabName === 'dashboard') {
                loadDashboard();
            }
        }
        
        // Funciones de administraci√≥n
        function verifyAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                document.getElementById('adminData').style.display = 'block';
                loadAdminData();
            } else {
                alert('Contrase√±a incorrecta');
            }
        }
        
        async function loadAdminData() {
            try {
                const snapshot = await database.ref('resultados').once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results).sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                    
                    let tableHTML = `
                        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                            <thead>
                                <tr style="background: rgba(59, 130, 246, 0.2);">
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Fecha/Hora</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Nombre Completo</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">C√©dula</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Pseud√≥nimo</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Puntaje</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Nivel</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Intento</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    resultsArray.forEach(result => {
                        tableHTML += `
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.fecha}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.nombre}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.cedula}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.pseudonimo}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.puntaje}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.nivel}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.intento}</td>
                            </tr>
                        `;
                    });
                    
                    tableHTML += '</tbody></table>';
                    document.getElementById('adminTable').innerHTML = tableHTML;
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }
        
        function exportAdminData() {
            if (!isAdminAuthenticated) {
                alert('Acceso no autorizado');
                return;
            }
            
            database.ref('resultados').once('value').then(snapshot => {
                const results = snapshot.val();
                if (results) {
                    const resultsArray = Object.values(results);
                    
                    let csv = 'Fecha/Hora,Nombre Completo,C√©dula,Pseud√≥nimo,Puntaje,Nivel M√°ximo,T√≠tulo,Intento\n';
                    
                    resultsArray.forEach(result => {
                        csv += `"${result.fecha}","${result.nombre}","${result.cedula}","${result.pseudonimo}",${result.puntaje},${result.nivel},"${result.titulo}",${result.intento}\n`;
                    });
                    
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `registro_completo_cardiologia_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                }
            });
        }
        
        function clearAllData() {
            if (!isAdminAuthenticated) {
                alert('Acceso no autorizado');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar TODOS los datos? Esta acci√≥n no se puede deshacer.')) {
                database.ref('resultados').remove();
                database.ref('estadisticas').remove();
                alert('Todos los datos han sido eliminados');
                loadAdminData();
                loadDashboard();
            }
        }
        
        // Funciones Firebase
        function setupFirebaseListeners() {
            database.ref('resultados').on('value', (snapshot) => {
                updateDashboardStats();
                updateTopPlayers();
                updateLiveFeed();
            });
        }
        
        async function checkPlayerAttempts(cedula) {
            try {
                const snapshot = await database.ref('resultados').orderByChild('cedula').equalTo(cedula).once('value');
                const results = snapshot.val();
                return results ? Object.keys(results).length : 0;
            } catch (error) {
                console.error('Error checking attempts:', error);
                return 0;
            }
        }
        
        async function saveGameResult(result) {
            try {
                const resultId = database.ref('resultados').push().key;
                
                await database.ref('resultados/' + resultId).set({
                    ...result,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    id: resultId
                });
                
                updateGlobalStats();
                
                console.log('Resultado guardado en Firebase:', resultId);
                return resultId;
            } catch (error) {
                console.error('Error saving result:', error);
                throw error;
            }
        }
        
        async function updateGlobalStats() {
            try {
                const snapshot = await database.ref('resultados').once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results);
                    const totalPlayers = resultsArray.length;
                    const avgScore = resultsArray.reduce((sum, r) => sum + r.puntaje, 0) / totalPlayers;
                    const maxLevel = Math.max(...resultsArray.map(r => r.nivel));
                    
                    const today = new Date().toDateString();
                    const playersToday = resultsArray.filter(r => 
                        new Date(r.fecha).toDateString() === today
                    ).length;
                    
                    await database.ref('estadisticas').set({
                        totalJugadores: totalPlayers,
                        promedioScore: Math.round(avgScore * 10) / 10,
                        nivelMaximo: maxLevel,
                        jugadoresHoy: playersToday,
                        ultimaActualizacion: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }
        
        // Funciones Dashboard
        function loadDashboard() {
            updateDashboardStats();
            updateTopPlayers();
            updateLiveFeed();
        }
        
        async function updateDashboardStats() {
            try {
                const snapshot = await database.ref('estadisticas').once('value');
                const stats = snapshot.val();
                
                if (stats) {
                    document.getElementById('totalJugadores').textContent = stats.totalJugadores || 0;
                    document.getElementById('promedioScore').textContent = stats.promedioScore || 0;
                    document.getElementById('nivelMaximo').textContent = stats.nivelMaximo || 0;
                    document.getElementById('jugadoresHoy').textContent = stats.jugadoresHoy || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        async function updateTopPlayers() {
            try {
                const snapshot = await database.ref('resultados').orderByChild('puntaje').limitToLast(20).once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results).sort((a, b) => b.puntaje - a.puntaje);
                    
                    const uniqueResults = new Map();
                    resultsArray.forEach(result => {
                        const existing = uniqueResults.get(result.pseudonimo);
                        if (!existing || result.puntaje > existing.puntaje) {
                            uniqueResults.set(result.pseudonimo, result);
                        }
                    });
                    
                    const topResults = Array.from(uniqueResults.values())
                        .sort((a, b) => b.puntaje - a.puntaje)
                        .slice(0, 10);
                    
                    const container = document.getElementById('topPlayers');
                    container.innerHTML = '';
                    
                    topResults.forEach((result, index) => {
                        const playerRank = document.createElement('div');
                        playerRank.className = 'player-rank';
                        
                        if (index === 0) playerRank.classList.add('podium-1');
                        else if (index === 1) playerRank.classList.add('podium-2');
                        else if (index === 2) playerRank.classList.add('podium-3');
                        
                        playerRank.innerHTML = `
                            <div class="rank-number">${index + 1}</div>
                            <div>
                                <div class="rank-name">${result.pseudonimo}</div>
                                <div class="rank-title">${levelTitles[result.nivel] || 'El que cura todo con agua con sal'}</div>
                            </div>
                            <div class="rank-score">${result.puntaje} pts</div>
                            <div class="rank-level">Nv.${result.nivel}</div>
                        `;
                        
                        container.appendChild(playerRank);
                    });
                }
            } catch (error) {
                console.error('Error loading top players:', error);
            }
        }
        
        async function updateLiveFeed() {
            try {
                const snapshot = await database.ref('resultados').orderByChild('timestamp').limitToLast(10).once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results).sort((a, b) => b.timestamp - a.timestamp);
                    
                    const container = document.getElementById('liveFeed');
                    container.innerHTML = '';
                    
                    resultsArray.forEach(result => {
                        const feedItem = document.createElement('div');
                        feedItem.className = 'feed-item';
                        
                        const timeAgo = getTimeAgo(result.timestamp);
                        
                        feedItem.innerHTML = `
                            <div>
                                <div class="feed-player">${result.pseudonimo}</div>
                            </div>
                            <div class="feed-score">${result.puntaje} pts - Nv.${result.nivel}</div>
                            <div class="feed-time">${timeAgo}</div>
                        `;
                        
                        container.appendChild(feedItem);
                    });
                }
            } catch (error) {
                console.error('Error loading live feed:', error);
            }
        }
        
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (days > 0) return `hace ${days}d`;
            if (hours > 0) return `hace ${hours}h`;
            if (minutes > 0) return `hace ${minutes}m`;
            return 'ahora';
        }
        
        // Funciones del juego
        async function startGame() {
            const name = document.getElementById('playerName').value.trim();
            const id = document.getElementById('playerId').value.trim();
            const pseudonym = document.getElementById('playerPseudonym').value.trim();
            
            if (!name || !id || !pseudonym) {
                alert('Por favor, complet√° todos los campos');
                return;
            }
            
            try {
                playerAttempts = await checkPlayerAttempts(id);
                
                if (playerAttempts >= 2) {
                    document.getElementById('intentosMessage').style.display = 'block';
                    document.getElementById('intentosMessage').textContent = 
                        '‚ùå Ya completaste tus 2 intentos permitidos. Solo pod√©s ver el dashboard.';
                    return;
                }
                
                if (playerAttempts === 1) {
                    document.getElementById('intentosMessage').style.display = 'block';
                    document.getElementById('intentosMessage').textContent = 
                        '‚ö†Ô∏è Este es tu segundo y √∫ltimo intento.';
                }
            } catch (error) {
                console.error('Error checking attempts:', error);
                alert('Error conectando con la base de datos. Intenta de nuevo.');
                return;
            }
            
            currentPlayer = { name, id, pseudonym };
            document.getElementById('displayName').textContent = name;
            document.getElementById('displayPseudonym').textContent = pseudonym;
            
            // Resetear variables del juego
            currentLevel = 1;
            score = 0;
            lives = 3;
            maxLevelReached = 1;
            answeredQuestions.clear();
            comodines = { fifty: true, change: true };
            document.getElementById('comodin5050').disabled = false;
            document.getElementById('comodinChange').disabled = false;
            
            updateScore();
            updateLivesDisplay();
            updateCurrentLevel();
            
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            showLevelScreen();
        }
        
        function showLevelScreen() {
            document.getElementById('levelScreen').style.display = 'block';
            document.getElementById('mainQuestionContainer').style.display = 'none';
            document.getElementById('nextButton').style.display = 'none';
            
            document.getElementById('levelNumber').textContent = currentLevel;
            document.getElementById('levelDescription').textContent = levelTitles[currentLevel] || "Nivel sin descripci√≥n";
        }
        
        function startLevel() {
            document.getElementById('levelScreen').style.display = 'none';
            document.getElementById('mainQuestionContainer').style.display = 'block';
            loadQuestion();
        }
        
        function loadQuestion() {
            eliminated5050 = false;
            
            // Filtrar preguntas disponibles del nivel actual
            const levelQuestions = questionBank.filter(q => q.level === currentLevel);
            const availableQuestions = levelQuestions.filter(q => !answeredQuestions.has(q.question));
            
            if (availableQuestions.length === 0) {
                // Si no hay preguntas disponibles, reiniciar el pool para este nivel
                answeredQuestions.forEach(q => {
                    const questionLevel = questionBank.find(qb => qb.question === q)?.level;
                    if (questionLevel === currentLevel) {
                        answeredQuestions.delete(q);
                    }
                });
                
                // Volver a filtrar
                const resetAvailable = levelQuestions.filter(q => !answeredQuestions.has(q.question));
                currentQuestion = resetAvailable.length > 0 ? 
                    resetAvailable[Math.floor(Math.random() * resetAvailable.length)] :
                    levelQuestions[Math.floor(Math.random() * levelQuestions.length)];
            } else {
                currentQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            }
            
            answeredQuestions.add(currentQuestion.question);
            
            document.getElementById('questionText').textContent = currentQuestion.question;
            shuffledOptions = currentQuestion.options.slice().sort(() => Math.random() - 0.5);
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            shuffledOptions.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option.text;
                optionElement.onclick = () => selectOption(option, optionElement);
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('nextButton').style.display = 'none';
            startTimer();
        }
        
        function startTimer() {
            timeLeft = 30;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 10) {
                    document.getElementById('timer').classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    timeOut();
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('timer').classList.remove('warning');
        }
        
        function updateTimerDisplay() {
            document.getElementById('timer').textContent = timeLeft;
        }
        
        function timeOut() {
            stopTimer();
            // Tiempo agotado = respuesta incorrecta = 0 puntos
            lives--;
            updateLivesDisplay();
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach((optElement, idx) => {
                optElement.classList.add('disabled');
                optElement.onclick = null;
                if (shuffledOptions[idx].correct) {
                    optElement.classList.add('correct');
                }
            });
            
            if (lives <= 0) {
                setTimeout(endGame, 2000);
            } else {
                setTimeout(() => {
                    document.getElementById('nextButton').style.display = 'inline-block';
                }, 1500);
            }
        }
        
        function selectOption(option, element) {
            stopTimer();
            
            if (element.classList.contains('eliminated')) {
                return;
            }
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.classList.add('disabled');
                opt.onclick = null;
            });
            
            // Sistema de puntuaci√≥n simplificado
            if (option.correct) {
                element.classList.add('correct');
                score += 1; // Respuesta correcta = +1
            } else {
                element.classList.add('incorrect');
                // Respuesta incorrecta = 0 puntos, perder vida
                lives--;
                
                // Mostrar la opci√≥n correcta
                allOptions.forEach((optElement, idx) => {
                    if (shuffledOptions[idx].correct) {
                        optElement.classList.add('correct');
                    }
                });
            }
            
            updateScore();
            updateLivesDisplay();
            
            if (lives <= 0) {
                setTimeout(endGame, 2000);
                return;
            }
            
            setTimeout(() => {
                document.getElementById('nextButton').style.display = 'inline-block';
            }, 1500);
        }
        
        function nextQuestion() {
            currentLevel++;
            updateCurrentLevel();
            
            if (currentLevel > maxLevelReached) {
                maxLevelReached = currentLevel;
            }
            
            if (currentLevel > 30) {
                endGame();
                return;
            }
            
            showLevelScreen();
        }
        
        function use5050() {
            if (!comodines.fifty) return;
            
            comodines.fifty = false;
            document.getElementById('comodin5050').disabled = true;
            
            const incorrectIndices = [];
            shuffledOptions.forEach((option, index) => {
                if (!option.correct) {
                    incorrectIndices.push(index);
                }
            });
            
            const toEliminate = incorrectIndices.sort(() => Math.random() - 0.5).slice(0, 2);
            
            toEliminate.forEach(index => {
                const optionElement = document.querySelectorAll('.option')[index];
                optionElement.classList.add('eliminated');
                optionElement.onclick = null;
            });
        }
        
        function changeQuestion() {
            if (!comodines.change) return;
            
            comodines.change = false;
            document.getElementById('comodinChange').disabled = true;
            
            answeredQuestions.delete(currentQuestion.question);
            stopTimer();
            loadQuestion();
        }
        
        function updateScore() {
            document.getElementById('score').textContent = score;
        }
        
        function updateCurrentLevel() {
            document.getElementById('currentLevelDisplay').textContent = currentLevel;
        }
        
        function updateLivesDisplay() {
            const hearts = ['heart1', 'heart2', 'heart3'];
            hearts.forEach((heartId, index) => {
                const heart = document.getElementById(heartId);
                if (index < lives) {
                    heart.className = 'heart active';
                } else {
                    heart.className = 'heart lost';
                }
            });
        }
        
        function getLevelTitle(level) {
            return levelTitles[level] || "El que cura todo con agua con sal";
        }
        
        async function endGame() {
            stopTimer();
            
            const result = {
                nombre: currentPlayer.name,
                cedula: currentPlayer.id,
                pseudonimo: currentPlayer.pseudonym,
                puntaje: score,
                nivel: maxLevelReached,
                titulo: getLevelTitle(maxLevelReached),
                fecha: new Date().toLocaleString('es-UY'),
                intento: playerAttempts + 1
            };
            
            try {
                await saveGameResult(result);
                console.log('Juego guardado exitosamente');
            } catch (error) {
                console.error('Error guardando juego:', error);
                alert('Error guardando el resultado. Tu progreso puede no haberse guardado.');
            }
            
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('maxLevel').textContent = maxLevelReached;
            document.getElementById('levelName').textContent = result.titulo;
            document.getElementById('levelHoroscope').textContent = 
                levelDescriptions[maxLevelReached] || levelDescriptions[1];
            
            document.getElementById('retryButton').style.display = 
                (playerAttempts + 1) < 2 ? 'inline-block' : 'none';
        }
        
        function retryGame() {
            lives = 3;
            currentLevel = 1;
            score = 0;
            maxLevelReached = 1;
            answeredQuestions.clear();
            comodines = { fifty: true, change: true };
            document.getElementById('comodin5050').disabled = false;
            document.getElementById('comodinChange').disabled = false;
            
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            updateScore();
            updateLivesDisplay();
            updateCurrentLevel();
            showLevelScreen();
        }
        
        function newGame() {
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('playerName').value = '';
            document.getElementById('playerId').value = '';
            document.getElementById('playerPseudonym').value = '';
            document.getElementById('intentosMessage').style.display = 'none';
        }
    </script>
</body>
</html>