<!DOCTYPE html>
<html lang="es-UY">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>¬øQui√©n quiere ser cardi√≥logo? - Competencia por Equipos</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow-x: hidden;
        }
        
        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, transparent 20%, rgba(59, 130, 246, 0.15) 20%, rgba(59, 130, 246, 0.15) 21%, transparent 21%, transparent 30%, rgba(59, 130, 246, 0.1) 30%, rgba(59, 130, 246, 0.1) 31%, transparent 31%);
            background-size: 60px 60px;
            animation: rotate 180s linear infinite;
            opacity: 0.4;
            z-index: -1;
        }
        
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }
        
        .container {
            width: 95%;
            max-width: 1200px;
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 24px;
            padding: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(59, 130, 246, 0.1);
            position: relative;
            z-index: 1;
            max-height: 95vh;
            overflow-y: auto;
        }
        
        /* Logos institucionales */
        .institutional-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-bottom: 20px;
            padding: 16px;
            background: rgba(30, 41, 59, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .logo-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        
        .logo {
            height: 60px;
            width: auto;
            opacity: 0.9;
            transition: all 0.3s ease;
            filter: brightness(1.1);
        }
        
        .logo:hover {
            opacity: 1;
            transform: scale(1.05);
        }
        
        .logo-text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: #94a3b8;
            text-align: center;
            font-weight: 500;
        }
        
        h1 {
            font-size: 2.75rem;
            font-weight: 700;
            text-align: center;
            background: linear-gradient(135deg, #60a5fa, #3b82f6, #2563eb);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            letter-spacing: -0.025em;
        }
        
        h2 {
            font-size: 1.875rem;
            font-weight: 600;
            text-align: center;
            color: #60a5fa;
            margin-bottom: 24px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .subtitle {
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
            color: #94a3b8;
            font-size: 1.125rem;
            margin-bottom: 32px;
            letter-spacing: 0.05em;
            font-weight: 500;
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 32px;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            background: rgba(30, 58, 138, 0.2);
            color: #e2e8f0;
            border: 2px solid rgba(59, 130, 246, 0.3);
            padding: 12px 24px;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
            font-size: 0.875rem;
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .nav-tab:hover:not(.active) {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
            transform: translateY(-1px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Admin Panel */
        .admin-panel {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid rgba(220, 38, 38, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .admin-password {
            width: 300px;
            padding: 12px;
            margin: 12px;
            background: rgba(15, 23, 42, 0.8);
            border: 2px solid rgba(220, 38, 38, 0.3);
            border-radius: 8px;
            color: #e2e8f0;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .admin-data {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        /* Pantalla de inicio */
        #startScreen {
            text-align: center;
        }
        
        .form-group {
            margin: 24px 0;
            text-align: left;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-size: 1.125rem;
            font-weight: 500;
            color: #60a5fa;
        }
        
        input, select {
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            color: #e2e8f0;
            font-family: 'Inter', sans-serif;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        select option {
            background: #1e293b;
            color: #e2e8f0;
        }
        
        .privacy-note {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin: 24px 0;
            font-size: 0.875rem;
            color: #94a3b8;
            line-height: 1.6;
        }
        
        .btn {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 8px;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.025em;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
        }
        
        /* Dashboard */
        .dashboard-section {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            margin: 24px 0;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin: 24px 0;
        }
        
        .stat-card {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .stat-card:hover {
            border-color: rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }
        
        .stat-number {
            font-size: 2.5rem;
            color: #60a5fa;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 8px;
        }
        
        /* Ranking por equipos */
        .team-rankings {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin: 24px 0;
        }
        
        .team-section {
            background: rgba(15, 23, 42, 0.6);
            border-radius: 16px;
            padding: 20px;
            border: 2px solid rgba(59, 130, 246, 0.2);
            transition: all 0.3s ease;
        }
        
        .team-section:hover {
            border-color: rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }
        
        .team-section.team-a {
            border-color: rgba(34, 197, 94, 0.4);
        }
        
        .team-section.team-b {
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .team-section.team-c {
            border-color: rgba(251, 191, 36, 0.4);
        }
        
        .team-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 8px;
        }
        
        .team-a .team-header {
            background: rgba(34, 197, 94, 0.1);
        }
        
        .team-b .team-header {
            background: rgba(59, 130, 246, 0.1);
        }
        
        .team-c .team-header {
            background: rgba(251, 191, 36, 0.1);
        }
        
        .team-name {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .team-a .team-name {
            color: #22c55e;
        }
        
        .team-b .team-name {
            color: #3b82f6;
        }
        
        .team-c .team-name {
            color: #fbbf24;
        }
        
        .team-stats {
            display: flex;
            gap: 16px;
            font-size: 0.875rem;
            color: #94a3b8;
        }
        
        .team-player {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            margin: 4px 0;
            background: rgba(30, 41, 59, 0.4);
            border-radius: 8px;
            font-size: 0.875rem;
        }
        
        .live-feed {
            background: rgba(15, 23, 42, 0.4);
            border-radius: 12px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .feed-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            animation: fadeIn 0.5s ease-out;
        }
        
        .feed-item:last-child {
            border-bottom: none;
        }
        
        .feed-player {
            font-weight: 600;
            color: #60a5fa;
        }
        
        .feed-team {
            font-size: 0.75rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }
        
        .feed-team.team-a {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .feed-team.team-b {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        .feed-team.team-c {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }
        
        .feed-score {
            color: #3b82f6;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 500;
        }
        
        .feed-time {
            font-size: 0.75rem;
            color: #64748b;
        }
        
        /* Pantalla de juego */
        #gameScreen {
            display: none;
        }
        
        .game-header {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 24px;
            align-items: center;
            margin-bottom: 32px;
            padding: 24px;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .player-info, .game-stats, .comodines {
            font-family: 'JetBrains Mono', monospace;
            text-align: center;
        }
        
        .player-team {
            margin-top: 8px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .player-team.team-a {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .player-team.team-b {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        .player-team.team-c {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }
        
        .lives {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 12px;
        }
        
        .heart {
            font-size: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.5));
        }
        
        .heart.active {
            color: #60a5fa;
            transform: scale(1);
        }
        
        .heart.lost {
            color: #334155;
            transform: scale(0.8);
            filter: none;
        }
        
        .comodines {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .comodin {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .comodin:hover:not(:disabled) {
            transform: scale(1.05) translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3);
        }
        
        .comodin:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Timer */
        .timer-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .timer {
            font-size: 2rem;
            font-weight: 700;
            color: #60a5fa;
            background: rgba(30, 41, 59, 0.8);
            padding: 12px 24px;
            border-radius: 50%;
            display: inline-block;
            min-width: 80px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .timer.warning {
            color: #f59e0b;
            border-color: #f59e0b;
            animation: pulse 0.5s infinite;
        }
        
        /* Pregunta y opciones */
        .question-container {
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 32px;
            margin: 24px 0;
        }
        
        .question {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 32px;
            line-height: 1.6;
            color: #e2e8f0;
            text-align: center;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }
        
        .option {
            background: rgba(15, 23, 42, 0.6);
            border: 2px solid rgba(59, 130, 246, 0.3);
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 1rem;
            text-align: left;
            line-height: 1.5;
            font-weight: 500;
        }
        
        .option:hover:not(.disabled) {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px -8px rgba(59, 130, 246, 0.3);
        }
        
        .option.correct {
            background: linear-gradient(135deg, #059669, #047857);
            border-color: #10b981;
            color: white;
            animation: correctAnimation 0.6s ease-out;
        }
        
        .option.incorrect {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border-color: #ef4444;
            color: white;
            animation: shake 0.6s ease-out;
        }
        
        .option.disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .option.eliminated {
            opacity: 0.3;
            background: rgba(51, 65, 85, 0.6);
            cursor: not-allowed;
            text-decoration: line-through;
        }
        
        @keyframes correctAnimation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-4px); }
            20%, 40%, 60%, 80% { transform: translateX(4px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Pantalla de nivel */
        #levelScreen {
            display: none;
            text-align: center;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 32px;
            margin: 24px 0;
        }
        
        .level-title {
            font-size: 2.25rem;
            font-weight: 700;
            color: #60a5fa;
            margin-bottom: 24px;
        }
        
        .level-description {
            font-size: 1.25rem;
            color: #94a3b8;
            margin-bottom: 32px;
            line-height: 1.6;
            font-style: italic;
        }
        
        /* Pantalla de resultados */
        #resultsScreen {
            display: none;
            text-align: center;
        }
        
        .final-score {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 24px 0;
        }
        
        .level-name {
            font-size: 1.5rem;
            color: #94a3b8;
            margin: 24px 0;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Rankings */
        .ranking-section {
            margin: 32px 0;
            background: rgba(30, 41, 59, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .ranking-title {
            font-size: 1.75rem;
            color: #60a5fa;
            margin-bottom: 24px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }
        
        .top-players {
            display: grid;
            gap: 12px;
            margin-bottom: 24px;
        }
        
        .player-rank {
            display: grid;
            grid-template-columns: 60px 2fr auto auto auto;
            gap: 16px;
            padding: 16px;
            background: rgba(15, 23, 42, 0.6);
            border-radius: 12px;
            align-items: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .player-rank:hover {
            transform: translateY(-1px);
        }
        
        .player-rank.podium-1 {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(245, 158, 11, 0.1));
            border: 2px solid #fbbf24;
        }
        
        .player-rank.podium-2 {
            background: linear-gradient(135deg, rgba(156, 163, 175, 0.2), rgba(107, 114, 128, 0.1));
            border: 2px solid #9ca3af;
        }
        
        .player-rank.podium-3 {
            background: linear-gradient(135deg, rgba(194, 120, 3, 0.2), rgba(146, 64, 14, 0.1));
            border: 2px solid #c2750b;
        }
        
        .rank-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
            text-align: center;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .rank-name {
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .rank-team {
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .rank-team.team-a {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .rank-team.team-b {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
        }
        
        .rank-team.team-c {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }
        
        .rank-score {
            font-family: 'JetBrains Mono', monospace;
            color: #3b82f6;
            font-weight: 600;
        }
        
        .rank-title {
            color: #94a3b8;
            font-size: 0.75rem;
            font-style: italic;
            margin-top: 4px;
            line-height: 1.2;
        }
        
        .rank-level {
            font-family: 'JetBrains Mono', monospace;
            color: #60a5fa;
            font-size: 0.875rem;
        }
        
        .horoscope-section {
            background: rgba(59, 130, 246, 0.1);
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            padding: 24px;
            margin: 32px 0;
            text-align: left;
        }
        
        .horoscope-title {
            color: #60a5fa;
            text-align: center;
            margin-bottom: 16px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }
        
        .horoscope-text {
            font-size: 1.125rem;
            line-height: 1.7;
            color: #e2e8f0;
            font-style: italic;
        }
        
        .loading {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            h1 {
                font-size: 2.25rem;
            }
            
            .container {
                padding: 16px;
            }
            
            .institutional-header {
                flex-direction: column;
                gap: 20px;
            }
            
            .logo {
                height: 50px;
            }
            
            .nav-tabs {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 8px;
            }
            
            .game-header {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .options {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            
            .player-rank {
                grid-template-columns: 40px 2fr auto;
                gap: 12px;
            }
            
            .rank-level, .rank-team {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .team-rankings {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header institucional -->
        <div class="institutional-header">
            <div class="logo-container">
                <img src="logo-ccu.png" alt="Centro Cardiovascular Universitario" class="logo" id="logo-ccu">
                <div class="logo-text">Centro Cardiovascular<br>Universitario</div>
            </div>
            <div class="logo-container">
                <img src="logo-uac.png" alt="Unidad Acad√©mica de Cardiolog√≠a" class="logo" id="logo-uac">
                <div class="logo-text">Unidad Acad√©mica<br>de Cardiolog√≠a</div>
            </div>
        </div>
        
        <!-- Navegaci√≥n -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showTab('dashboard')">üìä Dashboard</div>
            <div class="nav-tab" onclick="showTab('individual')">üèÜ Individual</div>
            <div class="nav-tab" onclick="showTab('equipos')">üë• Equipos</div>
            <div class="nav-tab" onclick="showTab('game')">üéÆ Jugar</div>
            <div class="nav-tab" onclick="showTab('admin')">üîê Admin</div>
        </div>
        
        <!-- Dashboard General -->
        <div id="dashboard" class="tab-content active">
            <h1>üè• Dashboard General</h1>
            <p class="subtitle">COMPETENCIA INDIVIDUAL Y POR EQUIPOS</p>
            
            <!-- Estad√≠sticas Generales -->
            <div class="dashboard-section">
                <h2>üìà Estad√≠sticas Generales</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalJugadores">-</div>
                        <div class="stat-label">Total Participantes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="promedioScore">-</div>
                        <div class="stat-label">Puntaje Promedio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="nivelMaximo">-</div>
                        <div class="stat-label">Nivel M√°ximo Alcanzado</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="jugadoresHoy">-</div>
                        <div class="stat-label">Participantes Hoy</div>
                    </div>
                </div>
            </div>
            
            <!-- Ranking por Equipos -->
            <div class="dashboard-section">
                <h2>ü•á Ranking de Equipos</h2>
                <div class="team-rankings" id="teamRankings">
                    <div class="loading">Cargando estad√≠sticas de equipos...</div>
                </div>
            </div>
            
            <!-- Feed en Vivo -->
            <div class="dashboard-section">
                <h2>üéÆ Actividad Reciente</h2>
                <div class="live-feed" id="liveFeed">
                    <div class="loading">Cargando actividad reciente...</div>
                </div>
            </div>
        </div>
        
        <!-- Ranking Individual -->
        <div id="individual" class="tab-content">
            <h1>üèÜ Ranking Individual</h1>
            <p class="subtitle">MEJORES PARTICIPANTES</p>
            
            <!-- Top 20 Individual -->
            <div class="ranking-section">
                <h2 class="ranking-title">üèÖ Top 20 Individual</h2>
                <div class="top-players" id="topIndividual">
                    <div class="loading">Cargando ranking individual...</div>
                </div>
            </div>
        </div>
        
        <!-- Ranking por Equipos -->
        <div id="equipos" class="tab-content">
            <h1>üë• Competencia por Equipos</h1>
            <p class="subtitle">RANKING DETALLADO POR GRUPO</p>
            
            <!-- Estad√≠sticas de Equipos -->
            <div class="dashboard-section">
                <h2>üìä Estad√≠sticas por Equipo</h2>
                <div class="team-rankings" id="detailedTeamStats">
                    <div class="loading">Cargando estad√≠sticas detalladas...</div>
                </div>
            </div>
        </div>
        
        <!-- Panel de Administraci√≥n -->
        <div id="admin" class="tab-content">
            <h1>üîê Panel de Administraci√≥n</h1>
            <p class="subtitle">ACCESO RESTRINGIDO</p>
            
            <div class="admin-panel">
                <h2>üîí Acceso Privado</h2>
                <p>Ingresa la contrase√±a para ver los datos de los participantes:</p>
                <input type="password" id="adminPassword" class="admin-password" placeholder="Contrase√±a de administrador">
                <br>
                <button class="btn" onclick="verifyAdmin()">Acceder</button>
                
                <div id="adminData" class="admin-data" style="display: none;">
                    <h3>üìã Registro Completo de Participantes</h3>
                    <button class="btn" onclick="exportAdminData()">üì• Descargar Excel</button>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Limpiar Datos</button>
                    
                    <div id="adminTable" style="margin-top: 20px;">
                        <!-- Tabla de admin se genera aqu√≠ -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Pantalla de Juego -->
        <div id="game" class="tab-content">
            <!-- Pantalla de inicio -->
            <div id="startScreen">
                <h1>¬øQui√©n quiere ser cardi√≥logo?</h1>
                <p class="subtitle">COMPETENCIA INDIVIDUAL Y POR EQUIPOS</p>
                
                <div class="form-group">
                    <label for="playerName">Nombre y apellido:</label>
                    <input type="text" id="playerName" placeholder="Dr. Juan P√©rez L√≥pez" required>
                </div>
                
                <div class="form-group">
                    <label for="playerId">C√©dula de identidad (sin d√≠gito verificador):</label>
                    <input type="text" id="playerId" placeholder="1234567" required>
                </div>
                
                <div class="form-group">
                    <label for="playerTeam">Grupo del foro:</label>
                    <select id="playerTeam" required>
                        <option value="">Selecciona tu grupo</option>
                        <option value="A">Grupo A</option>
                        <option value="B">Grupo B</option>
                        <option value="C">Grupo C</option>
                    </select>
                </div>
                
                <div class="privacy-note">
                    üèÜ <strong>Competencia:</strong> Particip√°s tanto en el ranking individual como en el de tu equipo. Tus datos personales son privados, solo se muestra tu nombre en los rankings.
                </div>
                
                <div id="intentosMessage" style="display: none; color: #f59e0b; margin: 20px 0; font-weight: bold;"></div>
                
                <button class="btn" onclick="startGame()">COMENZAR COMPETENCIA</button>
            </div>
            
            <!-- Pantalla de juego -->
            <div id="gameScreen">
                <div class="game-header">
                    <div class="player-info">
                        <div>Participante: <span id="displayName"></span></div>
                        <div class="player-team" id="displayTeam"></div>
                        <div class="lives">
                            Vidas: 
                            <span class="heart" id="heart1">üíô</span>
                            <span class="heart" id="heart2">üíô</span>
                            <span class="heart" id="heart3">üíô</span>
                        </div>
                    </div>
                    
                    <div class="game-stats">
                        <div>Nivel: <span id="currentLevelDisplay">1</span>/30</div>
                        <div>Puntaje: <span id="score">0</span></div>
                        <div class="timer-container">
                            <div class="timer" id="timer">30</div>
                        </div>
                    </div>
                    
                    <div class="comodines">
                        <button class="comodin" id="comodin5050" onclick="use5050()">üéØ 50/50</button>
                        <button class="comodin" id="comodinChange" onclick="changeQuestion()">üîÑ Cambiar</button>
                    </div>
                </div>
                
                <!-- Pantalla de nivel intermedia -->
                <div id="levelScreen">
                    <div class="level-title">NIVEL <span id="levelNumber"></span></div>
                    <div class="level-description" id="levelDescription"></div>
                    <button class="btn" onclick="startLevel()">COMENZAR NIVEL</button>
                </div>
                
                <div class="question-container" id="mainQuestionContainer" style="display: none;">
                    <div class="question" id="questionText"></div>
                    <div class="options" id="optionsContainer"></div>
                </div>
                
                <button class="btn" id="nextButton" style="display: none;" onclick="nextQuestion()">SIGUIENTE PREGUNTA</button>
            </div>
            
            <!-- Pantalla de resultados -->
            <div id="resultsScreen">
                <h1>¬°Competencia Terminada!</h1>
                <div class="final-score">Puntaje Final: <span id="finalScore">0</span></div>
                <div class="level-name" id="levelName"></div>
                <div>Nivel m√°ximo alcanzado: <span id="maxLevel">1</span>/30</div>
                
                <!-- Descripci√≥n humor√≠stica del nivel -->
                <div class="horoscope-section">
                    <h3 class="horoscope-title">üîç Diagn√≥stico de nivel alcanzado</h3>
                    <div class="horoscope-text" id="levelHoroscope"></div>
                </div>
                
                <button class="btn" id="retryButton" onclick="retryGame()">üîÑ REINTENTAR</button>
                <button class="btn" onclick="newGame()">üë§ NUEVO PARTICIPANTE</button>
                <button class="btn" onclick="showTab('dashboard')">üìä VER DASHBOARD</button>
            </div>
        </div>
    </div>
    
    <script>
        // Configuraci√≥n Firebase - TUS CREDENCIALES REALES
        const firebaseConfig = {
            apiKey: "AIzaSyAF1UK57tg4jK856RSU7Qcr1MT8QEeY4-o",
            authDomain: "cardiologia-game-uy.firebaseapp.com",
            databaseURL: "https://cardiologia-game-uy-default-rtdb.firebaseio.com",
            projectId: "cardiologia-game-uy",
            storageBucket: "cardiologia-game-uy.firebasestorage.app",
            messagingSenderId: "950754238661",
            appId: "1:950754238661:web:3df1bc9c9089f3308410ac",
            measurementId: "G-R6SPME7MHK"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        // Variables globales
        let currentPlayer = { name: '', id: '', team: '' };
        let currentLevel = 1;
        let score = 0;
        let lives = 3;
        let maxLevelReached = 1;
        let currentQuestion = null;
        let answeredQuestions = new Set();
        let timeLeft = 30;
        let timerInterval = null;
        let comodines = { fifty: true, change: true };
        let shuffledOptions = [];
        let eliminated5050 = false;
        let playerAttempts = 0;
        let isAdminAuthenticated = false;
        const ADMIN_PASSWORD = "cardio2025admin";
        
        // Banco de preguntas (mantenemos las 60 originales, despu√©s las reemplazar√°s con 120)
        const questionBank = [
            {"id": "ic_001", "level": 1, "question": "¬øCu√°l es el s√≠ntoma m√°s espec√≠fico de insuficiencia card√≠aca?", "options": [{"text": "Disnea de esfuerzo", "correct": false}, {"text": "Ortopnea", "correct": true}, {"text": "Edemas en miembros inferiores", "correct": false}, {"text": "Fatiga", "correct": false}]},
            {"id": "ic_002", "level": 1, "question": "¬øQu√© fracci√≥n de eyecci√≥n define la insuficiencia card√≠aca con funci√≥n reducida (ICFEr)?", "options": [{"text": "<50%", "correct": false}, {"text": "<40%", "correct": true}, {"text": "<35%", "correct": false}, {"text": "<30%", "correct": false}]},
            {"id": "ic_003", "level": 2, "question": "¬øQu√© biomarcador es m√°s espec√≠fico para diagn√≥stico de falla card√≠aca aguda?", "options": [{"text": "Troponina", "correct": false}, {"text": "P√©ptido natriur√©tico tipo B (BNP)", "correct": true}, {"text": "Creatinina", "correct": false}, {"text": "Procalcitonina", "correct": false}]},
            {"id": "ic_004", "level": 2, "question": "En pacientes con ICFEr, ¬øqu√© clase de f√°rmaco ha demostrado reducir mortalidad en todos los estudios?", "options": [{"text": "Diur√©ticos de asa", "correct": false}, {"text": "Betabloqueadores", "correct": true}, {"text": "Digoxina", "correct": false}, {"text": "Antagonistas del calcio", "correct": false}]},
            {"id": "ic_005", "level": 3, "question": "¬øQu√© par√°metro ecocardiogr√°fico es m√°s √∫til para evaluar presi√≥n de llenado ventricular izquierdo?", "options": [{"text": "Fracci√≥n de eyecci√≥n", "correct": false}, {"text": "Relaci√≥n E/e'", "correct": true}, {"text": "Volumen auricular izquierdo", "correct": false}, {"text": "TAPSE", "correct": false}]},
            {"id": "ic_006", "level": 3, "question": "En insuficiencia card√≠aca descompensada, ¬øqu√© signo f√≠sico es predictor de mal pron√≥stico?", "options": [{"text": "Hipotensi√≥n ortost√°tica", "correct": false}, {"text": "Tercer ruido card√≠aco (S3)", "correct": true}, {"text": "Soplo sist√≥lico", "correct": false}, {"text": "Pulso irregular", "correct": false}]},
            {"id": "ic_007", "level": 4, "question": "¬øQu√© mecanismo explica la mejor√≠a con sacubitril/valsart√°n vs. enalapril en PARADIGM-HF?", "options": [{"text": "Bloqueo dual del SRA y neprilisina", "correct": true}, {"text": "Supresi√≥n de aldosterona", "correct": false}, {"text": "Vasodilataci√≥n coronaria", "correct": false}, {"text": "Reducci√≥n de poscarga", "correct": false}]},
            {"id": "ic_008", "level": 4, "question": "En pacientes con ICFEr y fibrilaci√≥n auricular, ¬øqu√© estrategia tiene mejor evidencia de reducir hospitalizaciones?", "options": [{"text": "Control estricto de frecuencia", "correct": false}, {"text": "Ablaci√≥n de FA", "correct": true}, {"text": "Terapia antitromb√≥tica", "correct": false}, {"text": "Cardioversi√≥n el√©ctrica", "correct": false}]},
            {"id": "ic_009", "level": 5, "question": "¬øQu√© par√°metro hemodin√°mico invasivo define mejor la precarga ventricular izquierda?", "options": [{"text": "Presi√≥n arterial media", "correct": false}, {"text": "Presi√≥n capilar pulmonar", "correct": true}, {"text": "Gasto card√≠aco", "correct": false}, {"text": "Resistencia vascular sist√©mica", "correct": false}]},
            {"id": "ic_010", "level": 5, "question": "En s√≠ndrome cardiorrenal tipo 1, ¬øqu√© intervenci√≥n es m√°s efectiva para preservar funci√≥n renal?", "options": [{"text": "Suspensi√≥n de diur√©ticos", "correct": false}, {"text": "Terapia de ultrafiltraci√≥n", "correct": false}, {"text": "Optimizaci√≥n de volemia guiada por presi√≥n venosa", "correct": true}, {"text": "Aumento de dosis de IECA", "correct": false}]},
            {"id": "ic_011", "level": 6, "question": "¬øQu√© hallazgo en resonancia card√≠aca es diagn√≥stico de amiloidosis card√≠aca?", "options": [{"text": "Realce subendoc√°rdico", "correct": false}, {"text": "Realce transmural", "correct": false}, {"text": "Realce global subepic√°rdico", "correct": true}, {"text": "Defecto de perfusi√≥n reversible", "correct": false}]},
            {"id": "ic_012", "level": 6, "question": "En pacientes con miocardiopat√≠a hipertr√≥fica e IC refractaria, ¬øqu√© tratamiento tiene mejor evidencia?", "options": [{"text": "Alcohol septal", "correct": false}, {"text": "Micetom√≠a quir√∫rgica", "correct": true}, {"text": "Terapia de resincronizaci√≥n", "correct": false}, {"text": "Bloqueadores de canales de calcio", "correct": false}]},
            {"id": "ic_013", "level": 7, "question": "¬øQu√© gen es m√°s frecuentemente asociado a miocardiopat√≠a dilatada familiar?", "options": [{"text": "MYH7", "correct": false}, {"text": "TTN", "correct": true}, {"text": "LMNA", "correct": false}, {"text": "PKP2", "correct": false}]},
            {"id": "ic_014", "level": 7, "question": "En IC con FEVI 30% y bloqueo de rama izquierda, ¬øqu√© dispositivo reduce mortalidad s√∫bita?", "options": [{"text": "DAI convencional", "correct": true}, {"text": "DAI subcut√°neo", "correct": false}, {"text": "Marca pasos biventricular", "correct": false}, {"text": "Monitor implantable", "correct": false}]},
            {"id": "ic_015", "level": 8, "question": "¬øQu√© par√°metro de strain longitudinal global tiene valor pron√≥stico independiente en IC?", "options": [{"text": "Strain longitudinal > -15%", "correct": false}, {"text": "Strain longitudinal < -12%", "correct": false}, {"text": "Strain longitudinal < -8%", "correct": true}, {"text": "Strain radial > 35%", "correct": false}]},
            {"id": "ic_016", "level": 8, "question": "En taquimiocardiopat√≠a, ¬øqu√© intervalo de recuperaci√≥n de FEVI es caracter√≠stico?", "options": [{"text": "1-2 semanas", "correct": false}, {"text": "2-4 semanas", "correct": true}, {"text": "4-6 meses", "correct": false}, {"text": "Sin recuperaci√≥n", "correct": false}]},
            {"id": "ic_017", "level": 9, "question": "¬øQu√© f√°rmaco ha demostrado reducir eventos en IC con FE preservada?", "options": [{"text": "Espironolactona", "correct": false}, {"text": "Sacubitril/valsart√°n", "correct": false}, {"text": "Empagliflozina", "correct": true}, {"text": "Carvedilol", "correct": false}]},
            {"id": "ic_018", "level": 9, "question": "En shock cardiog√©nico refractario, ¬øqu√© dispositivo de asistencia tiene menor riesgo de hem√≥lisis?", "options": [{"text": "IABP", "correct": false}, {"text": "Impella CP", "correct": false}, {"text": "ECMO venoarterial", "correct": false}, {"text": "CentriMag", "correct": true}]},
            {"id": "ic_019", "level": 10, "question": "¬øQu√© patr√≥n de realce en RMN es t√≠pico de sarcoidosis card√≠aca?", "options": [{"text": "Realce epic√°rdico", "correct": false}, {"text": "Realce mesoc√°rdico", "correct": false}, {"text": "Realce parcheado no isqu√©mico", "correct": true}, {"text": "Realce transmural", "correct": false}]},
            {"id": "ic_020", "level": 10, "question": "En miocarditis fulminante, ¬øqu√© hallazgo histol√≥gico predice recuperaci√≥n?", "options": [{"text": "Infiltrado linfocitario", "correct": false}, {"text": "Necrosis mioc√≠tica focal", "correct": false}, {"text": "Edema intersticial", "correct": true}, {"text": "Fibrosis sustituyente", "correct": false}]},
            {"id": "ic_021", "level": 11, "question": "¬øQu√© terapia avanzada est√° indicada en IC con FEVI 15% y contraindicaci√≥n absoluta para trasplante?", "options": [{"text": "Terapia de resincronizaci√≥n", "correct": false}, {"text": "Oxigenaci√≥n hiperb√°rica", "correct": false}, {"text": "Asistencia ventricular izquierda", "correct": true}, {"text": "Denervaci√≥n renal", "correct": false}]},
            {"id": "ic_022", "level": 11, "question": "En amiloidosis por transtiretina, ¬øqu√© f√°rmaco estabiliza el tetr√°mero proteico?", "options": [{"text": "Diflunisal", "correct": false}, {"text": "Tafamidis", "correct": true}, {"text": "Patisiran", "correct": false}, {"text": "Inotersen", "correct": false}]},
            {"id": "ic_023", "level": 12, "question": "¬øQu√© par√°metro en cateterismo derecho define mejor la reserva contr√°ctil?", "options": [{"text": "Presi√≥n auricular derecha", "correct": false}, {"text": "Relaci√≥n dP/dt m√°xima", "correct": true}, {"text": "Resistencia pulmonar", "correct": false}, {"text": "Gasto card√≠aco", "correct": false}]},
            {"id": "ic_024", "level": 12, "question": "En disfunci√≥n primaria de injerto postrasplante, ¬øqu√© estrategia tiene mayor soporte?", "options": [{"text": "Ecmo venoarterial", "correct": true}, {"text": "Bal√≥n intra√≥rtico", "correct": false}, {"text": "Inotr√≥picos en altas dosis", "correct": false}, {"text": "Oxigenaci√≥n por membrana", "correct": false}]},
            {"id": "ic_025", "level": 13, "question": "¬øQu√© t√©cnica de imagen cuantifica mejor fibrosis mioc√°rdica difusa?", "options": [{"text": "Ecocardiograf√≠a con contraste", "correct": false}, {"text": "Tomograf√≠a por emisi√≥n de positrones", "correct": false}, {"text": "Resonancia magn√©tica con T1 mapping", "correct": true}, {"text": "TC coronario", "correct": false}]},
            {"id": "ic_026", "level": 13, "question": "En pacientes con DAI e infecci√≥n del dispositivo, ¬øcu√°l es el manejo √≥ptimo?", "options": [{"text": "Antibi√≥ticos prolongados", "correct": false}, {"text": "Extracci√≥n completa del sistema", "correct": true}, {"text": "Desbridamiento quir√∫rgico", "correct": false}, {"text": "Reemplazo parcial", "correct": false}]},
            {"id": "ic_027", "level": 14, "question": "¬øQu√© fenotipo de IC responde mejor a vericiguat seg√∫n el estudio VICTORIA?", "options": [{"text": "IC con FEVI <25%", "correct": false}, {"text": "IC con NT-proBNP <8000", "correct": false}, {"text": "IC recientemente descompensada", "correct": true}, {"text": "IC con fibrilaci√≥n auricular", "correct": false}]},
            {"id": "ic_028", "level": 14, "question": "En enfermedad de Chagas con IC, ¬øqu√© arritmia es marcador de mal pron√≥stico?", "options": [{"text": "Taquicardia ventricular sostenida", "correct": true}, {"text": "Bloqueo AV de primer grado", "correct": false}, {"text": "Extras√≠stoles ventriculares", "correct": false}, {"text": "Fibrilaci√≥n auricular", "correct": false}]},
            {"id": "ic_029", "level": 15, "question": "¬øQu√© patr√≥n hemodin√°mico define la falla ventricular derecha aislada?", "options": [{"text": "PCP >15 mmHg con IC bajo", "correct": false}, {"text": "PAD >10 mmHg con IC normal", "correct": false}, {"text": "PAD >15 mmHg con PCP normal", "correct": true}, {"text": "RVP >3 UW", "correct": false}]},
            {"id": "ic_030", "level": 15, "question": "En miocardiopat√≠a periparto, ¬øqu√© factor predice recuperaci√≥n completa?", "options": [{"text": "FEVI inicial >30%", "correct": false}, {"text": "Troponina elevada", "correct": false}, {"text": "FEVI >50% a los 6 meses", "correct": true}, {"text": "Edad materna <30 a√±os", "correct": false}]},
            {"id": "ic_031", "level": 16, "question": "¬øQu√© t√©cnica permite evaluaci√≥n directa de presi√≥n intracardiaca sin cateterismo?", "options": [{"text": "Ecocardiograf√≠a 4D", "correct": false}, {"text": "Monitor CardioMEMS", "correct": true}, {"text": "Resonancia con contraste", "correct": false}, {"text": "SPECT de perfusi√≥n", "correct": false}]},
            {"id": "ic_032", "level": 16, "question": "En terapia con inhibidores de SGLT2, ¬øqu√© efecto explica la reducci√≥n de descompensaciones?", "options": [{"text": "Reducci√≥n de glucosa", "correct": false}, {"text": "Disminuci√≥n de volumen intravascular", "correct": true}, {"text": "Aumento de contractilidad", "correct": false}, {"text": "Bloqueo neurohormonal", "correct": false}]},
            {"id": "ic_033", "level": 17, "question": "¬øQu√© valor de strain auricular izquierdo predice FA en IC?", "options": [{"text": "<15%", "correct": false}, {"text": "<23%", "correct": true}, {"text": "<30%", "correct": false}, {"text": "<35%", "correct": false}]},
            {"id": "ic_034", "level": 17, "question": "En s√≠ndrome de takotsubo, ¬øqu√© factor desencadenante es m√°s frecuente?", "options": [{"text": "Ejercicio intenso", "correct": false}, {"text": "Estr√©s emocional agudo", "correct": true}, {"text": "Hipertensi√≥n severa", "correct": false}, {"text": "Anestesia general", "correct": false}]},
            {"id": "ic_035", "level": 18, "question": "¬øQu√© gen mutado requiere DAI primario en miocardiopat√≠a dilatada?", "options": [{"text": "TTN truncante", "correct": false}, {"text": "LMNA", "correct": true}, {"text": "MYBPC3", "correct": false}, {"text": "DSP", "correct": false}]},
            {"id": "ic_036", "level": 18, "question": "En pacientes con DAI y tormenta el√©ctrica, ¬øqu√© f√°rmaco es primera l√≠nea?", "options": [{"text": "Amiodarona IV", "correct": true}, {"text": "Lidoca√≠na", "correct": false}, {"text": "Propranolol", "correct": false}, {"text": "Verapamilo", "correct": false}]},
            {"id": "ic_037", "level": 19, "question": "¬øQu√© biomarcador predice respuesta a hierro IV en IC?", "options": [{"text": "Ferritina <100", "correct": true}, {"text": "Transferrina baja", "correct": false}, {"text": "Hematocrito <35%", "correct": false}, {"text": "Hepcidina elevada", "correct": false}]},
            {"id": "ic_038", "level": 19, "question": "En IC terminal, ¬øqu√© escala valida mejor pron√≥stico a 6 meses?", "options": [{"text": "NYHA", "correct": false}, {"text": "MAGGIC", "correct": false}, {"text": "Seattle Heart Failure Model", "correct": false}, {"text": "Puntuaci√≥n de riesgo PAL-HF", "correct": true}]},
            {"id": "ic_039", "level": 20, "question": "¬øQu√© caracter√≠stica define la miocardiopat√≠a arritmog√©nica biventricular?", "options": [{"text": "Afectaci√≥n predominante de VI", "correct": false}, {"text": "Sustituci√≥n fibroadiposa en ambos ventr√≠culos", "correct": true}, {"text": "Dilataci√≥n aislada de VD", "correct": false}, {"text": "Asociaci√≥n con mutaci√≥n MYH7", "correct": false}]},
            {"id": "ic_040", "level": 20, "question": "En asistencia ventricular continua, ¬øqu√© par√°metro indica mal acoplamiento bomba-coraz√≥n?", "options": [{"text": "Flujo puls√°til <3 L/min", "correct": false}, {"text": "Apertura intermitente de v√°lvula a√≥rtica", "correct": true}, {"text": "PIA >15 mmHg", "correct": false}, {"text": "Diferencia de pulsos >20 mmHg", "correct": false}]},
            {"id": "ic_041", "level": 21, "question": "¬øQu√© t√©cnica quir√∫rgica mejora geometr√≠a ventricular en cardiomiopat√≠a isqu√©mica?", "options": [{"text": "Bypass aorto-coronario", "correct": false}, {"text": "Anuloplastia mitral", "correct": false}, {"text": "Procedimiento de Dor", "correct": true}, {"text": "Ablaci√≥n endoc√°rdica", "correct": false}]},
            {"id": "ic_042", "level": 21, "question": "En enfermedad de Fabry, ¬øqu√© hallazgo ecocardiogr√°fico es patognom√≥nico?", "options": [{"text": "Engrosamiento conc√©ntrico", "correct": false}, {"text": "Banda ecog√©nica endoc√°rdica", "correct": true}, {"text": "Aneurisma apical", "correct": false}, {"text": "Disfunci√≥n diast√≥lica grado III", "correct": false}]},
            {"id": "ic_043", "level": 22, "question": "¬øQu√© par√°metro en PET card√≠aco diagnostica inflamaci√≥n activa en sarcoidosis?", "options": [{"text": "Captaci√≥n heterog√©nea de FDG", "correct": true}, {"text": "Defecto de perfusi√≥n reversible", "correct": false}, {"text": "Captaci√≥n √≥sea asociada", "correct": false}, {"text": "SUV max >10", "correct": false}]},
            {"id": "ic_044", "level": 22, "question": "En hipertensi√≥n pulmonar postcapilar, ¬øqu√© f√°rmaco tiene indicaci√≥n espec√≠fica?", "options": [{"text": "Bosent√°n", "correct": false}, {"text": "Riociguat", "correct": false}, {"text": "Selexipag", "correct": false}, {"text": "Ninguno actualmente", "correct": true}]},
            {"id": "ic_045", "level": 23, "question": "¬øQu√© cambio gen√©tico requiere screening familiar en miocardiopat√≠a no compactada?", "options": [{"text": "Mutaci√≥n MYH7", "correct": false}, {"text": "Mutaci√≥n TTN", "correct": false}, {"text": "Mutaci√≥n LMNA", "correct": false}, {"text": "Mutaci√≥n MYBPC3", "correct": true}]},
            {"id": "ic_046", "level": 23, "question": "En disfunci√≥n diast√≥lica avanzada, ¬øqu√© maniobra mejora llenado ventricular?", "options": [{"text": "Reducci√≥n de frecuencia card√≠aca", "correct": true}, {"text": "Aumento de precarga", "correct": false}, {"text": "Vasodilatadores arteriales", "correct": false}, {"text": "Inotr√≥picos positivos", "correct": false}]},
            {"id": "ic_047", "level": 24, "question": "¬øQu√© patr√≥n en cateterismo define perfusi√≥n coronaria no obstructiva?", "options": [{"text": "FFR >0.80", "correct": false}, {"text": "IMR >25", "correct": true}, {"text": "CFR <2.0", "correct": false}, {"text": "RVR >1.0", "correct": false}]},
            {"id": "ic_048", "level": 24, "question": "En trasplante card√≠aco, ¬øqu√© valor de donante/recipiente es cr√≠tico para sobrevida?", "options": [{"text": "Diferencia de peso >20%", "correct": false}, {"text": "Diferencia de talla >10 cm", "correct": false}, {"text": "Proporci√≥n de masa ventricular", "correct": true}, {"text": "Edad donante >45 a√±os", "correct": false}]},
            {"id": "ic_049", "level": 25, "question": "¬øQu√© terapia g√©nica ha mostrado resultados prometedores en IC con FE reducida?", "options": [{"text": "Terapia con SERCA2a", "correct": true}, {"text": "Suplencia de distrofina", "correct": false}, {"text": "Modulaci√≥n de titina", "correct": false}, {"text": "Inhibici√≥n de fosfolamban", "correct": false}]},
            {"id": "ic_050", "level": 25, "question": "En shock cardiog√©nico por IAM, ¬øqu√© estrategia reduce mortalidad a 30 d√≠as?", "options": [{"text": "Revascularizaci√≥n completa inmediata", "correct": true}, {"text": "Soporte inotr√≥pico m√°ximo", "correct": false}, {"text": "Contrapulsaci√≥n intra√≥rtica", "correct": false}, {"text": "ECMO precoz", "correct": false}]},
            {"id": "ic_051", "level": 26, "question": "¬øQu√© par√°metro de resonancia cuantifica hierro mioc√°rdico en hemocromatosis?", "options": [{"text": "T1 nativo", "correct": false}, {"text": "T2*", "correct": true}, {"text": "Realce tard√≠o", "correct": false}, {"text": "T2 mapping", "correct": false}]},
            {"id": "ic_052", "level": 26, "question": "En miocardiopat√≠a diab√©tica, ¬øqu√© mecanismo explica la disfunci√≥n diast√≥lica precoz?", "options": [{"text": "Dep√≥sito de col√°geno", "correct": false}, {"text": "Alteraci√≥n metabolismo de calcio", "correct": false}, {"text": "Glicaci√≥n avanzada de prote√≠nas", "correct": true}, {"text": "Disfunci√≥n mitocondrial", "correct": false}]},
            {"id": "ic_053", "level": 27, "question": "¬øQu√© t√©cnica permite biopsia mioc√°rdica guiada por electroanatom√≠a?", "options": [{"text": "Eco intracard√≠aco", "correct": false}, {"text": "Navegaci√≥n electromagn√©tica", "correct": true}, {"text": "Fluoroscopia 3D", "correct": false}, {"text": "PET/CT fusionado", "correct": false}]},
            {"id": "ic_054", "level": 27, "question": "En IC con bloqueo completo de rama izquierda, ¬øqu√© par√°metro ecogr√°fico predice respuesta a TRC?", "options": [{"text": "Disfunci√≥n moderada de VD", "correct": false}, {"text": "Asincron√≠a septal tard√≠a", "correct": false}, {"text": "Retraso septal-lateral >65 ms", "correct": true}, {"text": "Strain radial <15%", "correct": false}]},
            {"id": "ic_055", "level": 28, "question": "¬øQu√© valor de presi√≥n de distensi√≥n arterial predice inestabilidad con vasodilatadores?", "options": [{"text": "PAD <65 mmHg", "correct": true}, {"text": "PAS <100 mmHg", "correct": false}, {"text": "PP <40 mmHg", "correct": false}, {"text": "PAM <70 mmHg", "correct": false}]},
            {"id": "ic_056", "level": 28, "question": "En recuperaci√≥n de funci√≥n ventricular, ¬øqu√© f√°rmaco debe continuarse indefinidamente?", "options": [{"text": "Betabloqueadores", "correct": true}, {"text": "IECA", "correct": false}, {"text": "Antagonistas de aldosterona", "correct": false}, {"text": "Diur√©ticos", "correct": false}]},
            {"id": "ic_057", "level": 29, "question": "¬øQu√© prote√≠na plasm√°tica es biomarcador de estr√©s de ret√≠culo endopl√°smico en IC?", "options": [{"text": "Galectina-3", "correct": false}, {"text": "ST2 soluble", "correct": false}, {"text": "GDF-15", "correct": false}, {"text": "GRP78", "correct": true}]},
            {"id": "ic_058", "level": 29, "question": "En terapia celular para IC, ¬øqu√© tipo celular tiene mayor potencial regenerativo?", "options": [{"text": "C√©lulas mononucleadas de m√©dula √≥sea", "correct": false}, {"text": "Cardiomiocitos derivados de iPSC", "correct": true}, {"text": "C√©lulas mesenquimales", "correct": false}, {"text": "C√©lulas CD34+", "correct": false}]},
            {"id": "ic_059", "level": 30, "question": "¬øQu√© sistema de neuromodulaci√≥n reduce actividad simp√°tica renal en IC refractaria?", "options": [{"text": "Estimulaci√≥n vagal", "correct": false}, {"text": "Barorreflex activation therapy", "correct": false}, {"text": "Ablaci√≥n simp√°tica renal", "correct": true}, {"text": "Modulaci√≥n de m√©dula espinal", "correct": false}]},
            {"id": "ic_060", "level": 30, "question": "En asistencia ventricular total artificial, ¬øqu√© dispositivo tiene mayor durabilidad?", "options": [{"text": "HeartMate 3", "correct": true}, {"text": "Novacor", "correct": false}, {"text": "SynCardia", "correct": false}, {"text": "Jarvik 2000", "correct": false}]}
        ];
        
        // T√≠tulos por nivel (30 niveles completos)
        const levelTitles = {
            1: "El que cura todo con agua con sal",
            2: "El que dice 'para el coraz√≥n lo mejor es el ajo'",
            3: "El botija que confunde un estetoscopio con un cargador",
            4: "El que cree que la presi√≥n se mide con el dedo en la mu√±eca",
            5: "El interno que ausculta la espalda buscando el ritmo sinusal",
            6: "El que receta ibuprofeno para el dolor precordial 'por las dudas'",
            7: "El que cree que el ecocardio se hace con gel y buena onda",
            8: "Aquel que convierte un dolor de pecho en un diagn√≥stico de 15 l√≠neas",
            9: "El que interpreta la radiograf√≠a como si fuera una constelaci√≥n",
            10: "El que escucha un soplo y pide en secreto que no le pregunten de qu√© es",
            11: "El que prescribe seg√∫n lo que ley√≥ en un grupo de WhatsApp",
            12: "El que dice 'probemos con carvedilol a ver qu√© pasa'",
            13: "El que escucha un R3 y lo anota aunque no est√© seguro si no eran gases",
            14: "El que ya no dice 'tiene algo de falla' habla de IC con elementos congestivos",
            15: "El que pide BNP con cara seria aunque no sepa bien c√≥mo interpretarlo",
            16: "El que empieza a citar art√≠culos y ya no solo frases de la cl√≠nica m√©dica",
            17: "El que entiende que no todo lo que se hincha es por 'retenci√≥n'",
            18: "El que ya no ve todo como blanco y negro sino como 4 cuadrantes de Forrester",
            19: "El que sabe que los gliflozins no son una banda de rock noruega",
            20: "El que dej√≥ de hablar de la FEVI, y mete strain y remodelado",
            21: "El que se emociona con un TAPSE >20 como si fuera una buena noticia familiar",
            22: "El que empieza a explicar la IC con analog√≠as elegantes",
            23: "El que discute la clasificaci√≥n universal de infarto como si hubiera estado en la mesa donde la armaron",
            24: "El que ajusta dosis de beta bloqueantes como quien afina una guitarra",
            25: "El que lee el ECG como si fuera partitura y encuentra la m√∫sica oculta",
            26: "El que distingue entre empeoramiento cl√≠nico y progresi√≥n insidiosa",
            27: "El que recomienda rehabilitaci√≥n cardiaca y se emociona al decir 'multidisciplinario'",
            28: "El que se indigna si no hay seguimiento post-alta",
            29: "El que gu√≠a al Heart Team con calma y convicci√≥n, como pastor cl√≠nico",
            30: "Or√°culo cardiol√≥gico Manuel Quintela, de punta y al medio"
        };
        
        // Descripciones humor√≠sticas (30 hor√≥scopos √∫nicos)
        const levelDescriptions = {
            1: "Felicitaciones, est√°s en el nivel b√°sico de la medicina casera. Tu principal herramienta terap√©utica es el agua con sal, que seg√∫n vos cura desde un resfr√≠o hasta una arritmia ventricular. En el fondo, ten√©s fe ciega en los remedios de la abuela.",
            2: "Has avanzado al nivel de curandero barrial. Tu arsenal se expandi√≥: ajo para la presi√≥n, manzanilla para los nervios y cebolla para todo lo dem√°s. Todav√≠a cre√©s que el lim√≥n puede destapar arterias.",
            3: "Sos ese interno tierno que todos quieren proteger. Confund√≠s cables con instrumental m√©dico y ten√©s esa inocencia que hace que los pacientes te sonr√≠an con ternura. Al menos ya no intent√°s escuchar el coraz√≥n por la espalda.",
            4: "Nivel estudiante avanzado: ya sab√©s que el pulso no se toma con el dedo gordo, pero segu√≠s buscando el punto exacto en la mu√±eca como si fuera un tesoro escondido. Los pacientes te tienen paciencia.",
            5: "Sos el que ausculta con cara seria pero en realidad est√° rezando para que no le pregunten qu√© escuchaste. Al menos ya diferenci√°s entre un pulm√≥n y un coraz√≥n en la radiograf√≠a.",
            6: "Nivel 'm√©dico precavido': para cualquier dolor en el pecho recet√°s ibuprofeno 'por las dudas' y mand√°s al paciente a caminar. Tu filosof√≠a es 'si se mejora solo, mejor'.",
            7: "Ya entendiste que el ecocardiograma no es solo gel y buena onda, pero segu√≠s viendo las im√°genes como si fueran nubes en el cielo. Al menos pregunt√°s cosas que suenan t√©cnicas.",
            8: "Has desarrollado el talento especial de convertir un simple dolor de pecho en un diagn√≥stico diferencial de 15 patolog√≠as. Tu especialidad es encontrar zebras donde hay caballos.",
            9: "Interpret√°s las radiograf√≠as como constelaciones c√≥smicas. Ves patrones donde no los hay, pero al menos ya no confund√≠s una costilla con el coraz√≥n. Progreso lento pero seguro.",
            10: "Escuch√°s soplos por todos lados, aunque no est√©s muy seguro de qu√© tipo son. Tu estrategia es anotar 'soplo sist√≥lico grado II/VI' y que alguien m√°s se haga cargo.",
            11: "Tu conocimiento m√©dico proviene principalmente de grupos de WhatsApp de m√©dicos. Cit√°s papers que nunca le√≠ste completos y us√°s t√©rminos en ingl√©s para sonar m√°s profesional.",
            12: "Entraste en la era del carvedilol experimental. Tu frase favorita es 'probemos con carvedilol a ver qu√© pasa'. Al menos ya sab√©s que es un betabloqueante.",
            13: "Desarrollaste el o√≠do m√°gico para escuchar R3, aunque la mitad de las veces son gases intestinales. Pero lo anot√°s en la historia igual, por si acaso ten√≠as raz√≥n.",
            14: "Evolucionaste del 'tiene algo de falla' al sofisticado 'IC con elementos congestivos'. Tu vocabulario se est√° volviendo m√°s elegante, aunque segu√≠s sin estar muy seguro.",
            15: "Ped√≠s BNP con cara de experto, aunque despu√©s google√°s discretamente c√≥mo interpretarlo. Al menos ya sab√©s que tiene que ver con el coraz√≥n y no con el ri√±√≥n.",
            16: "Comenzaste a citar estudios reales: 'seg√∫n PARADIGM-HF...' aunque solo le√≠ste el abstract. Pero son√°s convincente y eso es lo que importa en esta etapa.",
            17: "Ya entendiste que no todo lo que se hincha es 'retenci√≥n'. Empezaste a usar t√©rminos como 'sobrecarga de volumen' y 'redistribuci√≥n'. Tu evoluci√≥n sem√°ntica es notable.",
            18: "Descubriste los cuadrantes de Forrester y ahora clasific√°s todo en h√∫medo-seco, fr√≠o-caliente. Es como el juego de la batalla naval pero con hemodinamia.",
            19: "Aprendiste que los gliflozinas no son una banda noruega de metal, sino que son medicamentos revolucionarios. Empezaste a recetar con m√°s fundamento cient√≠fico.",
            20: "Dejaste de hablar solo de FEVI. Ahora met√©s strain, remodelado y funci√≥n diast√≥lica. Tu jerga cardiol√≥gica se est√° volviendo respetable y casi comprensible.",
            21: "Te emocion√°s genuinamente cuando ves un TAPSE mayor a 20 mm, como si fuera una buena noticia familiar. Ya entend√©s que el ventr√≠culo derecho tambi√©n existe e importa.",
            22: "Desarrollaste el arte de explicar la IC con analog√≠as elegantes: compar√°s el coraz√≥n con una bomba de agua, los vasos con mangueras. Tus pacientes te entienden y agradecen.",
            23: "Discut√≠s la clasificaci√≥n universal de infarto como si hubieras estado en la mesa donde la escribieron. Cit√°s a Thygesen con la familiaridad de quien lo conoce personalmente.",
            24: "Ajust√°s dosis de betabloqueantes como un m√∫sico que afina su guitarra: con precisi√≥n, paciencia y sabiendo que cada peque√±o cambio puede hacer una gran diferencia.",
            25: "Le√©s el ECG como si fuera una partitura musical y encontr√°s la melod√≠a oculta en cada complejo QRS. Los ritmos card√≠acos tienen m√∫sica para vos.",
            26: "Distingu√≠s entre empeoramiento cl√≠nico franco y progresi√≥n insidiosa silenciosa. Tu ojo cl√≠nico se afin√≥ y pod√©s detectar matices sutiles que antes te pasaban inadvertidos.",
            27: "Recomend√°s rehabilitaci√≥n card√≠aca y te emocion√°s al pronunciar 'abordaje multidisciplinario'. Entendiste que curar no es solo recetar pastillas.",
            28: "Te indign√°s genuinamente cuando no hay seguimiento post-alta adecuado. Sab√©s que el alta hospitalaria es solo el comienzo del verdadero tratamiento.",
            29: "Gui√°s al Heart Team con la calma y convicci√≥n de un pastor experimentado. Tu juicio cl√≠nico se volvi√≥ una br√∫jula confiable para decisiones complejas.",
            30: "Llegaste al olimpo cardiol√≥gico uruguayo. Sos el or√°culo del Hospital de Cl√≠nicas, de punta y al medio. Los residentes te consultan, los adjuntos te respetan, y los pacientes te bendicen."
        };
        
        // Inicializaci√≥n
        window.addEventListener('load', function() {
            loadDashboard();
            setupFirebaseListeners();
            updateLivesDisplay();
            handleMissingLogos();
            console.log('App inicializada con Firebase - Competencia por equipos');
        });
        
        // Manejar logos faltantes
        function handleMissingLogos() {
            const logos = ['logo-ccu', 'logo-uac'];
            logos.forEach(logoId => {
                const img = document.getElementById(logoId);
                img.onerror = function() {
                    this.style.display = 'none';
                    this.nextElementSibling.style.display = 'none';
                };
            });
        }
        
        // Funciones de navegaci√≥n
        function showTab(tabName) {
            // Ocultar todos los tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Ocultar todos los nav-tabs activos
            document.querySelectorAll('.nav-tab').forEach(navTab => {
                navTab.classList.remove('active');
            });
            
            // Mostrar tab seleccionado
            document.getElementById(tabName).classList.add('active');
            
            // Activar nav-tab correspondiente
            event.target.classList.add('active');
            
            // Cargar datos espec√≠ficos seg√∫n el tab
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'individual':
                    loadIndividualRanking();
                    break;
                case 'equipos':
                    loadTeamRankings();
                    break;
            }
        }
        
        // Funciones de administraci√≥n
        function verifyAdmin() {
            const password = document.getElementById('adminPassword').value;
            if (password === ADMIN_PASSWORD) {
                isAdminAuthenticated = true;
                document.getElementById('adminData').style.display = 'block';
                loadAdminData();
            } else {
                alert('Contrase√±a incorrecta');
            }
        }
        
        async function loadAdminData() {
            try {
                const snapshot = await database.ref('resultados').once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results).sort((a, b) => new Date(b.fecha) - new Date(a.fecha));
                    
                    let tableHTML = `
                        <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                            <thead>
                                <tr style="background: rgba(59, 130, 246, 0.2);">
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Fecha/Hora</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Nombre Completo</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">C√©dula</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Grupo</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Puntaje</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Nivel</th>
                                    <th style="padding: 12px; border: 1px solid rgba(59, 130, 246, 0.3);">Intento</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    resultsArray.forEach(result => {
                        tableHTML += `
                            <tr>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.fecha}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.nombre}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.cedula}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.grupo}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.puntaje}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.nivel}</td>
                                <td style="padding: 8px; border: 1px solid rgba(59, 130, 246, 0.2);">${result.intento}</td>
                            </tr>
                        `;
                    });
                    
                    tableHTML += '</tbody></table>';
                    document.getElementById('adminTable').innerHTML = tableHTML;
                }
            } catch (error) {
                console.error('Error loading admin data:', error);
            }
        }
        
        function exportAdminData() {
            if (!isAdminAuthenticated) {
                alert('Acceso no autorizado');
                return;
            }
            
            database.ref('resultados').once('value').then(snapshot => {
                const results = snapshot.val();
                if (results) {
                    const resultsArray = Object.values(results);
                    
                    let csv = 'Fecha/Hora,Nombre Completo,C√©dula,Grupo,Puntaje,Nivel M√°ximo,T√≠tulo,Intento\n';
                    
                    resultsArray.forEach(result => {
                        csv += `"${result.fecha}","${result.nombre}","${result.cedula}","${result.grupo}",${result.puntaje},${result.nivel},"${result.titulo}",${result.intento}\n`;
                    });
                    
                    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                    const link = document.createElement('a');
                    link.href = URL.createObjectURL(blob);
                    link.download = `competencia_cardiologia_${new Date().toISOString().split('T')[0]}.csv`;
                    link.click();
                }
            });
        }
        
        function clearAllData() {
            if (!isAdminAuthenticated) {
                alert('Acceso no autorizado');
                return;
            }
            
            if (confirm('¬øEst√°s seguro de que quieres eliminar TODOS los datos? Esta acci√≥n no se puede deshacer.')) {
                database.ref('resultados').remove();
                database.ref('estadisticas').remove();
                alert('Todos los datos han sido eliminados');
                loadAdminData();
                loadDashboard();
            }
        }
        
        // Funciones Firebase
        function setupFirebaseListeners() {
            database.ref('resultados').on('value', (snapshot) => {
                updateDashboardStats();
                updateTeamRankings();
                updateLiveFeed();
            });
        }
        
        async function checkPlayerAttempts(cedula) {
            try {
                const snapshot = await database.ref('resultados').orderByChild('cedula').equalTo(cedula).once('value');
                const results = snapshot.val();
                return results ? Object.keys(results).length : 0;
            } catch (error) {
                console.error('Error checking attempts:', error);
                return 0;
            }
        }
        
        async function saveGameResult(result) {
            try {
                const resultId = database.ref('resultados').push().key;
                
                await database.ref('resultados/' + resultId).set({
                    ...result,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    id: resultId
                });
                
                updateGlobalStats();
                
                console.log('Resultado guardado en Firebase:', resultId);
                return resultId;
            } catch (error) {
                console.error('Error saving result:', error);
                throw error;
            }
        }
        
        async function updateGlobalStats() {
            try {
                const snapshot = await database.ref('resultados').once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results);
                    const totalPlayers = resultsArray.length;
                    const avgScore = resultsArray.reduce((sum, r) => sum + r.puntaje, 0) / totalPlayers;
                    const maxLevel = Math.max(...resultsArray.map(r => r.nivel));
                    
                    // Contar jugadores de hoy
                    const today = new Date().toDateString();
                    const playersToday = resultsArray.filter(r => {
                        const resultDate = new Date(r.timestamp || 0).toDateString();
                        return resultDate === today;
                    }).length;
                    
                    // Estad√≠sticas por equipo
                    const teamStats = {
                        A: { players: 0, totalScore: 0, avgScore: 0, maxLevel: 0 },
                        B: { players: 0, totalScore: 0, avgScore: 0, maxLevel: 0 },
                        C: { players: 0, totalScore: 0, avgScore: 0, maxLevel: 0 }
                    };
                    
                    resultsArray.forEach(result => {
                        const team = result.grupo;
                        if (teamStats[team]) {
                            teamStats[team].players++;
                            teamStats[team].totalScore += result.puntaje;
                            teamStats[team].maxLevel = Math.max(teamStats[team].maxLevel, result.nivel);
                        }
                    });
                    
                    // Calcular promedios por equipo
                    Object.keys(teamStats).forEach(team => {
                        if (teamStats[team].players > 0) {
                            teamStats[team].avgScore = Math.round((teamStats[team].totalScore / teamStats[team].players) * 10) / 10;
                        }
                    });
                    
                    await database.ref('estadisticas').set({
                        totalJugadores: totalPlayers,
                        promedioScore: Math.round(avgScore * 10) / 10,
                        nivelMaximo: maxLevel,
                        jugadoresHoy: playersToday,
                        equipos: teamStats,
                        ultimaActualizacion: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }
        
        // Funciones Dashboard
        function loadDashboard() {
            updateDashboardStats();
            updateTeamRankings();
            updateLiveFeed();
        }
        
        async function updateDashboardStats() {
            try {
                const snapshot = await database.ref('estadisticas').once('value');
                const stats = snapshot.val();
                
                if (stats) {
                    document.getElementById('totalJugadores').textContent = stats.totalJugadores || 0;
                    document.getElementById('promedioScore').textContent = stats.promedioScore || 0;
                    document.getElementById('nivelMaximo').textContent = stats.nivelMaximo || 0;
                    document.getElementById('jugadoresHoy').textContent = stats.jugadoresHoy || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        async function updateTeamRankings() {
            try {
                const snapshot = await database.ref('estadisticas/equipos').once('value');
                const teamStats = snapshot.val();
                
                if (teamStats) {
                    const container = document.getElementById('teamRankings');
                    container.innerHTML = '';
                    
                    // Ordenar equipos por promedio
                    const sortedTeams = Object.entries(teamStats)
                        .sort(([,a], [,b]) => b.avgScore - a.avgScore);
                    
                    sortedTeams.forEach(([teamName, stats]) => {
                        const teamSection = document.createElement('div');
                        teamSection.className = `team-section team-${teamName.toLowerCase()}`;
                        
                        teamSection.innerHTML = `
                            <div class="team-header">
                                <div class="team-name">GRUPO ${teamName}</div>
                                <div class="team-stats">
                                    <span>üë• ${stats.players}</span>
                                    <span>üèÜ ${stats.avgScore} pts</span>
                                    <span>üìà Nv.${stats.maxLevel}</span>
                                </div>
                            </div>
                        `;
                        
                        container.appendChild(teamSection);
                    });
                }
            } catch (error) {
                console.error('Error loading team rankings:', error);
            }
        }
        
        async function loadIndividualRanking() {
            try {
                const snapshot = await database.ref('resultados').orderByChild('puntaje').limitToLast(20).once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results).sort((a, b) => b.puntaje - a.puntaje);
                    
                    // Obtener mejor resultado por jugador (por c√©dula)
                    const uniqueResults = new Map();
                    resultsArray.forEach(result => {
                        const existing = uniqueResults.get(result.cedula);
                        if (!existing || result.puntaje > existing.puntaje) {
                            uniqueResults.set(result.cedula, result);
                        }
                    });
                    
                    const topResults = Array.from(uniqueResults.values())
                        .sort((a, b) => b.puntaje - a.puntaje)
                        .slice(0, 20);
                    
                    const container = document.getElementById('topIndividual');
                    container.innerHTML = '';
                    
                    topResults.forEach((result, index) => {
                        const playerRank = document.createElement('div');
                        playerRank.className = 'player-rank';
                        
                        if (index === 0) playerRank.classList.add('podium-1');
                        else if (index === 1) playerRank.classList.add('podium-2');
                        else if (index === 2) playerRank.classList.add('podium-3');
                        
                        playerRank.innerHTML = `
                            <div class="rank-number">${index + 1}</div>
                            <div>
                                <div class="rank-name">${result.nombre}</div>
                                <div class="rank-title">${levelTitles[result.nivel] || 'El que cura todo con agua con sal'}</div>
                            </div>
                            <div class="rank-team team-${result.grupo?.toLowerCase() || 'a'}">Grupo ${result.grupo || 'A'}</div>
                            <div class="rank-score">${result.puntaje} pts</div>
                            <div class="rank-level">Nv.${result.nivel}</div>
                        `;
                        
                        container.appendChild(playerRank);
                    });
                }
            } catch (error) {
                console.error('Error loading individual ranking:', error);
            }
        }
        
        async function loadTeamRankings() {
            try {
                const snapshot = await database.ref('resultados').once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results);
                    
                    // Agrupar por equipo y obtener mejor resultado por jugador
                    const teamPlayers = {
                        A: new Map(),
                        B: new Map(),
                        C: new Map()
                    };
                    
                    resultsArray.forEach(result => {
                        const team = result.grupo;
                        if (teamPlayers[team]) {
                            const existing = teamPlayers[team].get(result.cedula);
                            if (!existing || result.puntaje > existing.puntaje) {
                                teamPlayers[team].set(result.cedula, result);
                            }
                        }
                    });
                    
                    const container = document.getElementById('detailedTeamStats');
                    container.innerHTML = '';
                    
                    // Crear secci√≥n para cada equipo
                    ['A', 'B', 'C'].forEach(teamName => {
                        const players = Array.from(teamPlayers[teamName].values())
                            .sort((a, b) => b.puntaje - a.puntaje);
                        
                        const avgScore = players.length > 0 ? 
                            Math.round((players.reduce((sum, p) => sum + p.puntaje, 0) / players.length) * 10) / 10 : 0;
                        const maxLevel = players.length > 0 ? 
                            Math.max(...players.map(p => p.nivel)) : 0;
                        
                        const teamSection = document.createElement('div');
                        teamSection.className = `team-section team-${teamName.toLowerCase()}`;
                        
                        let playersHTML = '';
                        players.slice(0, 10).forEach((player, index) => {
                            playersHTML += `
                                <div class="team-player">
                                    <span>${index + 1}. ${player.nombre}</span>
                                    <span>${player.puntaje} pts - Nv.${player.nivel}</span>
                                </div>
                            `;
                        });
                        
                        teamSection.innerHTML = `
                            <div class="team-header">
                                <div class="team-name">GRUPO ${teamName}</div>
                                <div class="team-stats">
                                    <span>üë• ${players.length}</span>
                                    <span>üèÜ ${avgScore} pts</span>
                                    <span>üìà Nv.${maxLevel}</span>
                                </div>
                            </div>
                            <div style="margin-top: 16px;">
                                <h3 style="color: #94a3b8; margin-bottom: 12px; font-size: 1rem;">Top 10 del grupo:</h3>
                                ${playersHTML || '<div style="color: #64748b; font-style: italic;">No hay participantes a√∫n</div>'}
                            </div>
                        `;
                        
                        container.appendChild(teamSection);
                    });
                }
            } catch (error) {
                console.error('Error loading team rankings:', error);
            }
        }
        
        async function updateLiveFeed() {
            try {
                const snapshot = await database.ref('resultados').orderByChild('timestamp').limitToLast(10).once('value');
                const results = snapshot.val();
                
                if (results) {
                    const resultsArray = Object.values(results).sort((a, b) => b.timestamp - a.timestamp);
                    
                    const container = document.getElementById('liveFeed');
                    container.innerHTML = '';
                    
                    resultsArray.forEach(result => {
                        const feedItem = document.createElement('div');
                        feedItem.className = 'feed-item';
                        
                        const timeAgo = getTimeAgo(result.timestamp);
                        
                        feedItem.innerHTML = `
                            <div>
                                <div class="feed-player">${result.nombre}</div>
                                <div class="feed-team team-${result.grupo?.toLowerCase() || 'a'}">Grupo ${result.grupo || 'A'}</div>
                            </div>
                            <div class="feed-score">${result.puntaje} pts - Nv.${result.nivel}</div>
                            <div class="feed-time">${timeAgo}</div>
                        `;
                        
                        container.appendChild(feedItem);
                    });
                }
            } catch (error) {
                console.error('Error loading live feed:', error);
            }
        }
        
        function getTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (days > 0) return `hace ${days}d`;
            if (hours > 0) return `hace ${hours}h`;
            if (minutes > 0) return `hace ${minutes}m`;
            return 'ahora';
        }
        
        // Funciones del juego
        async function startGame() {
            const name = document.getElementById('playerName').value.trim();
            const id = document.getElementById('playerId').value.trim();
            const team = document.getElementById('playerTeam').value;
            
            if (!name || !id || !team) {
                alert('Por favor, complet√° todos los campos');
                return;
            }
            
            // Validar formato de c√©dula (solo n√∫meros, sin d√≠gito verificador)
            if (!/^\d{6,8}$/.test(id)) {
                alert('La c√©dula debe tener entre 6 y 8 d√≠gitos, sin d√≠gito verificador');
                return;
            }
            
            try {
                playerAttempts = await checkPlayerAttempts(id);
                
                if (playerAttempts >= 2) {
                    document.getElementById('intentosMessage').style.display = 'block';
                    document.getElementById('intentosMessage').textContent = 
                        '‚ùå Ya completaste tus 2 intentos permitidos. Solo pod√©s ver el dashboard.';
                    return;
                }
                
                if (playerAttempts === 1) {
                    document.getElementById('intentosMessage').style.display = 'block';
                    document.getElementById('intentosMessage').textContent = 
                        '‚ö†Ô∏è Este es tu segundo y √∫ltimo intento.';
                }
            } catch (error) {
                console.error('Error checking attempts:', error);
                alert('Error conectando con la base de datos. Intenta de nuevo.');
                return;
            }
            
            currentPlayer = { name, id, team };
            document.getElementById('displayName').textContent = name;
            
            // Mostrar equipo con estilo
            const teamDisplay = document.getElementById('displayTeam');
            teamDisplay.textContent = `Grupo ${team}`;
            teamDisplay.className = `player-team team-${team.toLowerCase()}`;
            
            // Resetear variables del juego
            currentLevel = 1;
            score = 0;
            lives = 3;
            maxLevelReached = 1;
            answeredQuestions.clear();
            comodines = { fifty: true, change: true };
            document.getElementById('comodin5050').disabled = false;
            document.getElementById('comodinChange').disabled = false;
            
            updateScore();
            updateLivesDisplay();
            updateCurrentLevel();
            
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            showLevelScreen();
        }
        
        function showLevelScreen() {
            document.getElementById('levelScreen').style.display = 'block';
            document.getElementById('mainQuestionContainer').style.display = 'none';
            document.getElementById('nextButton').style.display = 'none';
            
            document.getElementById('levelNumber').textContent = currentLevel;
            document.getElementById('levelDescription').textContent = levelTitles[currentLevel] || "Nivel sin descripci√≥n";
        }
        
        function startLevel() {
            document.getElementById('levelScreen').style.display = 'none';
            document.getElementById('mainQuestionContainer').style.display = 'block';
            loadQuestion();
        }
        
        function loadQuestion() {
            eliminated5050 = false;
            
            // Filtrar preguntas disponibles del nivel actual
            const levelQuestions = questionBank.filter(q => q.level === currentLevel);
            const availableQuestions = levelQuestions.filter(q => !answeredQuestions.has(q.question));
            
            if (availableQuestions.length === 0) {
                // Si no hay preguntas disponibles, reiniciar el pool para este nivel
                answeredQuestions.forEach(q => {
                    const questionLevel = questionBank.find(qb => qb.question === q)?.level;
                    if (questionLevel === currentLevel) {
                        answeredQuestions.delete(q);
                    }
                });
                
                // Volver a filtrar
                const resetAvailable = levelQuestions.filter(q => !answeredQuestions.has(q.question));
                currentQuestion = resetAvailable.length > 0 ? 
                    resetAvailable[Math.floor(Math.random() * resetAvailable.length)] :
                    levelQuestions[Math.floor(Math.random() * levelQuestions.length)];
            } else {
                currentQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            }
            
            answeredQuestions.add(currentQuestion.question);
            
            document.getElementById('questionText').textContent = currentQuestion.question;
            shuffledOptions = currentQuestion.options.slice().sort(() => Math.random() - 0.5);
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            shuffledOptions.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option.text;
                optionElement.onclick = () => selectOption(option, optionElement);
                optionsContainer.appendChild(optionElement);
            });
            
            document.getElementById('nextButton').style.display = 'none';
            startTimer();
        }
        
        function startTimer() {
            timeLeft = 30;
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 10) {
                    document.getElementById('timer').classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    timeOut();
                }
            }, 1000);
        }
        
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            document.getElementById('timer').classList.remove('warning');
        }
        
        function updateTimerDisplay() {
            document.getElementById('timer').textContent = timeLeft;
        }
        
        function timeOut() {
            stopTimer();
            // Tiempo agotado = respuesta incorrecta = 0 puntos
            lives--;
            updateLivesDisplay();
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach((optElement, idx) => {
                optElement.classList.add('disabled');
                optElement.onclick = null;
                if (shuffledOptions[idx].correct) {
                    optElement.classList.add('correct');
                }
            });
            
            if (lives <= 0) {
                setTimeout(endGame, 2000);
            } else {
                setTimeout(() => {
                    document.getElementById('nextButton').style.display = 'inline-block';
                }, 1500);
            }
        }
        
        function selectOption(option, element) {
            stopTimer();
            
            if (element.classList.contains('eliminated')) {
                return;
            }
            
            const allOptions = document.querySelectorAll('.option');
            allOptions.forEach(opt => {
                opt.classList.add('disabled');
                opt.onclick = null;
            });
            
            // Sistema de puntuaci√≥n simplificado
            if (option.correct) {
                element.classList.add('correct');
                score += 1; // Respuesta correcta = +1
            } else {
                element.classList.add('incorrect');
                // Respuesta incorrecta = 0 puntos, perder vida
                lives--;
                
                // Mostrar la opci√≥n correcta
                allOptions.forEach((optElement, idx) => {
                    if (shuffledOptions[idx].correct) {
                        optElement.classList.add('correct');
                    }
                });
            }
            
            updateScore();
            updateLivesDisplay();
            
            if (lives <= 0) {
                setTimeout(endGame, 2000);
                return;
            }
            
            setTimeout(() => {
                document.getElementById('nextButton').style.display = 'inline-block';
            }, 1500);
        }
        
        function nextQuestion() {
            // Verificar ANTES de incrementar si ya completamos todos los niveles
            if (currentLevel >= 30) {
                endGame();
                return;
            }
            
            currentLevel++;
            updateCurrentLevel();
            
            if (currentLevel > maxLevelReached) {
                maxLevelReached = currentLevel;
            }
            
            showLevelScreen();
        }
        
        function use5050() {
            if (!comodines.fifty) return;
            
            comodines.fifty = false;
            document.getElementById('comodin5050').disabled = true;
            
            const incorrectIndices = [];
            shuffledOptions.forEach((option, index) => {
                if (!option.correct) {
                    incorrectIndices.push(index);
                }
            });
            
            const toEliminate = incorrectIndices.sort(() => Math.random() - 0.5).slice(0, 2);
            
            toEliminate.forEach(index => {
                const optionElement = document.querySelectorAll('.option')[index];
                optionElement.classList.add('eliminated');
                optionElement.onclick = null;
            });
        }
        
        function changeQuestion() {
            if (!comodines.change) return;
            
            comodines.change = false;
            document.getElementById('comodinChange').disabled = true;
            
            // Guardar la pregunta actual para no repetirla
            const currentQuestionText = currentQuestion.question;
            
            // Filtrar preguntas disponibles del nivel actual (excluyendo la actual)
            const levelQuestions = questionBank.filter(q => q.level === currentLevel && q.question !== currentQuestionText);
            const availableQuestions = levelQuestions.filter(q => !answeredQuestions.has(q.question));
            
            if (availableQuestions.length > 0) {
                // Hay preguntas disponibles diferentes
                currentQuestion = availableQuestions[Math.floor(Math.random() * availableQuestions.length)];
            } else {
                // No hay m√°s preguntas, usar cualquiera diferente a la actual
                const differentQuestions = levelQuestions.length > 0 ? levelQuestions : 
                    questionBank.filter(q => q.level === currentLevel && q.question !== currentQuestionText);
                if (differentQuestions.length > 0) {
                    currentQuestion = differentQuestions[Math.floor(Math.random() * differentQuestions.length)];
                } else {
                    // √öltimo recurso: mantener la pregunta actual
                    alert('No hay m√°s preguntas disponibles para este nivel');
                    comodines.change = true;
                    document.getElementById('comodinChange').disabled = false;
                    return;
                }
            }
            
            answeredQuestions.add(currentQuestion.question);
            
            // Recargar la interfaz
            document.getElementById('questionText').textContent = currentQuestion.question;
            shuffledOptions = currentQuestion.options.slice().sort(() => Math.random() - 0.5);
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            shuffledOptions.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'option';
                optionElement.textContent = option.text;
                optionElement.onclick = () => selectOption(option, optionElement);
                optionsContainer.appendChild(optionElement);
            });
            
            // Reiniciar timer
            stopTimer();
            startTimer();
        }
        
        function updateScore() {
            document.getElementById('score').textContent = score;
        }
        
        function updateCurrentLevel() {
            document.getElementById('currentLevelDisplay').textContent = currentLevel;
        }
        
        function updateLivesDisplay() {
            const hearts = ['heart1', 'heart2', 'heart3'];
            hearts.forEach((heartId, index) => {
                const heart = document.getElementById(heartId);
                if (index < lives) {
                    heart.className = 'heart active';
                } else {
                    heart.className = 'heart lost';
                }
            });
        }
        
        function getLevelTitle(level) {
            return levelTitles[level] || "El que cura todo con agua con sal";
        }
        
        async function endGame() {
            stopTimer();
            
            // Asegurar que el nivel m√°ximo nunca exceda 30
            if (maxLevelReached > 30) {
                maxLevelReached = 30;
            }
            
            const result = {
                nombre: currentPlayer.name,
                cedula: currentPlayer.id,
                grupo: currentPlayer.team,
                puntaje: score,
                nivel: maxLevelReached,
                titulo: getLevelTitle(maxLevelReached),
                fecha: new Date().toLocaleString('es-UY'),
                intento: playerAttempts + 1
            };
            
            try {
                await saveGameResult(result);
                console.log('Resultado guardado exitosamente');
            } catch (error) {
                console.error('Error guardando resultado:', error);
                alert('Error guardando el resultado. Tu progreso puede no haberse guardado.');
            }
            
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultsScreen').style.display = 'block';
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('maxLevel').textContent = maxLevelReached;
            document.getElementById('levelName').textContent = result.titulo;
            document.getElementById('levelHoroscope').textContent = 
                levelDescriptions[maxLevelReached] || levelDescriptions[1];
            
            document.getElementById('retryButton').style.display = 
                (playerAttempts + 1) < 2 ? 'inline-block' : 'none';
        }
        
        function retryGame() {
            lives = 3;
            currentLevel = 1;
            score = 0;
            maxLevelReached = 1;
            answeredQuestions.clear();
            comodines = { fifty: true, change: true };
            document.getElementById('comodin5050').disabled = false;
            document.getElementById('comodinChange').disabled = false;
            
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            updateScore();
            updateLivesDisplay();
            updateCurrentLevel();
            showLevelScreen();
        }
        
        function newGame() {
            document.getElementById('resultsScreen').style.display = 'none';
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('playerName').value = '';
            document.getElementById('playerId').value = '';
            document.getElementById('playerTeam').value = '';
            document.getElementById('intentosMessage').style.display = 'none';
        }
    </script>
</body>
</html>